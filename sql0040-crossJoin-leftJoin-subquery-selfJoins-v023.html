<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>sql0040-crossjoin-leftjoin-subquery-selfjoins-v023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/clipboard/clipboard.min.js"></script>
<script src="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/quarto-html/quarto.js"></script>
<script src="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/quarto-html/popper.min.js"></script>
<script src="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/quarto-html/anchor.min.js"></script>
<link href="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sql0040-crossJoin-leftJoin-subquery-selfJoins-v023_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="more-joins-crossleftrightfull-subqueries-set-operations-case-self-joins" class="level1">
<h1><yrchapternumber>33. </yrchapternumber> more joins (cross/left/right/full), subqueries, set operations, case, self joins</h1>
<section id="the-books-database" class="level2">
<h2 class="anchored" data-anchor-id="the-books-database">The “books database”</h2>
<p>In this and other sections we will be referring to the “books database”.</p>
<p>Click below to download a document that describes the books database and database technology in general. This document also contains many questions/answers to test your knowledge of SQL. You can also download the CSV files that contain the data for the books database.</p>
</section>
<section id="click-to-download-the-specified-files" class="level2">
<h2 class="anchored" data-anchor-id="click-to-download-the-specified-files">click to download the specified files</h2>
<ul>
<li><a href="data/booksDatabaseDescription-withQuestions-ANSWERS-v020.docx">booksDatabase description and Questions</a></li>
<li><a href="data/booksDatabase/titles.csv">titles.csv</a></li>
<li><a href="data/booksDatabase/authors.csv">authors.csv</a></li>
<li><a href="data/booksDatabase/publishers.csv">publishers.csv</a></li>
<li><a href="data/booksDatabase/title_authors.csv">title_authors.csv</a></li>
<li><a href="data/booksDatabase/royalties.csv">royalties</a></li>
</ul>
</section>
<section id="read-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-the-data">read in the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the packages we'll need</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(sqldf, <span class="at">quietly=</span><span class="cn">TRUE</span>, <span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)) { <span class="fu">install.packages</span>(<span class="st">"sqldf"</span>); <span class="fu">require</span>(sqldf) }</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(readr, <span class="at">quietly=</span><span class="cn">TRUE</span>, <span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)) { <span class="fu">install.packages</span>(<span class="st">"readr"</span>); <span class="fu">require</span>(readr) }</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the data for the books database - see the </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>titles <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/booksDatabase/titles.csv"</span>, <span class="at">na=</span><span class="st">"NULL"</span>, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>authors <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/booksDatabase/authors.csv"</span>, <span class="at">na=</span><span class="st">"NULL"</span>, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>publishers <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/booksDatabase/publishers.csv"</span>, <span class="at">na=</span><span class="st">"NULL"</span>, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>title_authors <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/booksDatabase/title_authors.csv"</span>, <span class="at">na=</span><span class="st">"NULL"</span>, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>royalties <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/booksDatabase/royalties.csv"</span>, <span class="at">na=</span><span class="st">"NULL"</span>, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-join" class="level2">
<h2 class="anchored" data-anchor-id="cross-join">CROSS JOIN</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################################################</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A "cross join" is very different from the joins that we've already learned about.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A "cross join" joins EVERY row from 1st table with EVERY row from 2nd table.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For this reason, a cross join does not specify an on condition.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################################################</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example - suppose a kindergarten teacher is using a relational database </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># to manage her classroom :)    Suppose she has several toys and several children.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># One table, students, describes the children,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Another table, toys, describes the toys.</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">"abie"</span>, <span class="st">"bobbie"</span>, <span class="st">"clara"</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">"aames"</span>, <span class="st">"berger"</span>, <span class="st">"cohen"</span>),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">"m"</span>, <span class="st">"m"</span>, <span class="st">"f"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>students</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name gender
1       abie     aames      m
2     bobbie    berger      m
3      clara     cohen      f</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>toys <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">toy_name =</span> <span class="fu">c</span>(<span class="st">"doggie"</span>, <span class="st">"dumbo"</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(<span class="st">"suffed dog"</span>, <span class="st">"elephant"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>toys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  toy_name description
1   doggie  suffed dog
2    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select * from students order by last_name, first_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name gender
1       abie     aames      m
2     bobbie    berger      m
3      clara     cohen      f</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select * from toys order by toy_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  toy_name description
1   doggie  suffed dog
2    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The teacher wants to make sure that each child has a chance to play</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with each of the toys. </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore she might run the following "cross join" to see a list</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># of each child and each toy. She can use this result as a checklist</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># to make sure that each child actually did play with each toy.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select students.*, toys.*</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">       from students CROSS JOIN toys</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="st">       order by last_name, first_name, toy_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name gender toy_name description
1       abie     aames      m   doggie  suffed dog
2       abie     aames      m    dumbo    elephant
3     bobbie    berger      m   doggie  suffed dog
4     bobbie    berger      m    dumbo    elephant
5      clara     cohen      f   doggie  suffed dog
6      clara     cohen      f    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># About the asterisks ( * ) in the SELECT clause ...</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The asterisks in the query above (i.e. select students.*, toys.* ...)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># means that the results should include all of the columns from the</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># students table (i.e. students.*) and all of the columns from the</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># toys table (i.e. toys.*). </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This can be done more concisely with just "select * ..." the query below</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># does the exact same thing as the query above since "select * ..." means</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># to include all of the columns from all of the tables in the output.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select *</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="st">       from students CROSS JOIN toys</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="st">       order by last_name, first_name, toy_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name gender toy_name description
1       abie     aames      m   doggie  suffed dog
2       abie     aames      m    dumbo    elephant
3     bobbie    berger      m   doggie  suffed dog
4     bobbie    berger      m    dumbo    elephant
5      clara     cohen      f   doggie  suffed dog
6      clara     cohen      f    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The reason for using tablename.* is apparent when you want to </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># include all of the columns from some of the tables but not from the other</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tables. For example the following query displays only some of the columns</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># from the students table (students.gender is NOT displayed). It does display</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ALL of the columns from the toys table (ie. toys.*)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select students.first_name, students.last_name, toys.*</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">       from students CROSS JOIN toys</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">       order by last_name, first_name, toy_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name toy_name description
1       abie     aames   doggie  suffed dog
2       abie     aames    dumbo    elephant
3     bobbie    berger   doggie  suffed dog
4     bobbie    berger    dumbo    elephant
5      clara     cohen   doggie  suffed dog
6      clara     cohen    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># select table.column ...        vs       select column ... </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># You must include table names in the SELECT clause for columns that </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># appear in more than one table. Column names that that only appear </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># in a single table in the query do NOT need to be preceded by the table name. </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore the following </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># query is the same as the above query. This is because first_name and</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># last_name only appear as columns in the students table and do not appear </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># in the toys table.</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># However, it is PERMISSIBLE to include the table name for ANY column (even</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># if the column only appears in a single table).</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Some people prefer to include the table name even when it </span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># is not necessary (as done above) to make it clearer to someone reading the </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># code which table contains which columns.</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Same results as above (read comment above)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select first_name, last_name, toys.*</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="st">       from students CROSS JOIN toys</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="st">       order by last_name, first_name, toy_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name toy_name description
1       abie     aames   doggie  suffed dog
2       abie     aames    dumbo    elephant
3     bobbie    berger   doggie  suffed dog
4     bobbie    berger    dumbo    elephant
5      clara     cohen   doggie  suffed dog
6      clara     cohen    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    # rows   =   #rows from table1   X   #rows from table2</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The total number of rows in the output of a "cross join" is</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the product of the number of rows in the first table times </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the number of rows in the 2nd table. In the example above, since</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># students contains 3 rows and toys contains 2 rows, the cross </span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># join contains 6 rows.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># You can use any other clauses in a cross join</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># You an add any of the other clauses (where, group by, having, limit) </span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># to a "cross join". For example, if the teacher only needs the</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># results of the "cross join" for the boys she can add a where</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># clause as follows:</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select students.*, toys.*</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="st">       from students CROSS JOIN toys</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="st">       where gender = 'm'</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="st">       order by last_name, first_name, toy_name</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_name last_name gender toy_name description
1       abie     aames      m   doggie  suffed dog
2       abie     aames      m    dumbo    elephant
3     bobbie    berger      m   doggie  suffed dog
4     bobbie    berger      m    dumbo    elephant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------------------------------------------------------------</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># "Cartesian product" is another name for a "cross join"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The concept of a "cross join" also exists outside the scope of databases.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifically in mathematical "set theory" the concept of a "cross join" </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># is known as a "cartesian product". Sometimes, people will refer to </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the term "cartesian product" in discussions about databases. However in </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># a select statement the words you can type are only "cross join" (NOT "cartesian product"). </span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------------------------------------------------------------</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------------------------------------------------------------</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># All other types of joins depend on cross joins</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># On some occasions the need for a cross join arises, but </span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># cross joins are not used nearly as often as other types of joins. </span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Nevertheless, it is important to understand the concept of a cross join since</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># every other type of join ("innner join", "left join", "right join", "full join")</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># depends on a "cross join".</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># For example when calculating the result of an</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># "inner join" the database management system (DBMS) starts by first performing a cross join.</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co"># The DBMS then removes rows from the result of the cross join based on the </span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co"># conditions specified in the on clause and the where clause of the "inner join".</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co"># A more typical example</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Many people find it hard to understand why you would want to use a cross join.</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># This confusion stems from the fact that rows from the two tables are combined</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># in the result even if there is seemingly no logical reason to combine them.</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co"># It is easiest to see the results of a cross join when you have very few rows.</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore we will create two very small tables, favTitles and favPublishers</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co"># My favorite titles</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>favTitles <span class="ot">=</span> <span class="fu">sqldf</span>(<span class="st">"select title_name, type, pub_id, pages</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="st">                   from titles</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="st">                   where title_id in ('T04', 'T05', 'T10')</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="st">                   order by title_name"</span>)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>favTitles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages
1   But I Did It Unconciously psychology    P01   510
2      Exchange of Platitudes psychology    P01   201
3 Not Without My Fabrerge Egg  biography    P05    NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Publishers of those favorite titles</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>favPublishers <span class="ot">=</span> <span class="fu">sqldf</span>(<span class="st">"select pub_id, pub_name, city</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">                       from publishers</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">                       where pub_id in ('P01', 'P05')</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">                       order by pub_id"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>favPublishers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pub_id          pub_name     city
1    P01 Abatis Publishers New York
2    P05    AAA Publishing Berkeley</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is a cross join. It returns every record from the </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># first table (favTitles) paired up with every record from the 2nd table</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (favPublishers). </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that the pub_id's on each row of the cross join results do NOT</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># necessarily match. Therefore, it may be confusing as to why you should</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use a cross join ... (keep reading)</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select favTitles.*, favPublishers.*</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="st">       from favTitles CROSS JOIN favPublishers</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages pub_id          pub_name     city
1   But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York
2   But I Did It Unconciously psychology    P01   510    P05    AAA Publishing Berkeley
3      Exchange of Platitudes psychology    P01   201    P01 Abatis Publishers New York
4      Exchange of Platitudes psychology    P01   201    P05    AAA Publishing Berkeley
5 Not Without My Fabrerge Egg  biography    P05    NA    P01 Abatis Publishers New York
6 Not Without My Fabrerge Egg  biography    P05    NA    P05    AAA Publishing Berkeley</code></pre>
</div>
</div>
</section>
<section id="every-inner-join-starts-with-a-cross-join" class="level2">
<h2 class="anchored" data-anchor-id="every-inner-join-starts-with-a-cross-join">Every INNER JOIN starts with a CROSS JOIN</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following adds a where clause to the code. The where clause</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># removes those rows from</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the cross join for which the favTitles.pub_id and the favPublishers.pub_id</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># don't match. This is really what you want in this case. In order</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># to get the correct results, first a CROSS JOIN was done that created</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># all possible combinations of a row from favTitles with a row from favPublishers.</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Then the where clause eliminated the rows in the output that didn't make sense.</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This leaves us with rows that show the details for a title and the details</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># of the publisher who published that title. </span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select favTitles.*, favPublishers.*</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="st">       from favTitles CROSS JOIN favPublishers</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="st">       where favTitles.pub_id = favPublishers.pub_id</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages pub_id          pub_name     city
1   But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York
2      Exchange of Platitudes psychology    P01   201    P01 Abatis Publishers New York
3 Not Without My Fabrerge Egg  biography    P05    NA    P05    AAA Publishing Berkeley</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Another way of writing the same query is with an "inner join" (which </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can also be written as just "join"). This version of the query </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># uses the word "join" instead of "cross join" and moves the condition</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># that ties the tables together from the where clause into the "on" clause.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This does EXACTLY THE SAME THING as the above query (with CROSS JOIN). </span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># However, the "join" syntax with its "on" clause makes the details of </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># how the two tables are related to each other more obvious. </span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select favTitles.*, favPublishers.*</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="st">       from favTitles JOIN favPublishers ON favTitles.pub_id = favPublishers.pub_id</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages pub_id          pub_name     city
1   But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York
2      Exchange of Platitudes psychology    P01   201    P01 Abatis Publishers New York
3 Not Without My Fabrerge Egg  biography    P05    NA    P05    AAA Publishing Berkeley</code></pre>
</div>
</div>
</section>
<section id="the-word-inner-in-inner-join-is-optional" class="level2">
<h2 class="anchored" data-anchor-id="the-word-inner-in-inner-join-is-optional">The word INNER in “INNER JOIN” is optional</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># JOIN vs INNER JOIN</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The technical term for this type of join is an "INNER JOIN".</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># However, you can write either "INNER JOIN" or just "JOIN".</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The following does the same thing as the previous query.</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The only difference in the code is that we added the</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># word "INNER".</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select favTitles.*, favPublishers.*</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="st">       from favTitles INNER JOIN favPublishers ON favTitles.pub_id = favPublishers.pub_id</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages pub_id          pub_name     city
1   But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York
2      Exchange of Platitudes psychology    P01   201    P01 Abatis Publishers New York
3 Not Without My Fabrerge Egg  biography    P05    NA    P05    AAA Publishing Berkeley</code></pre>
</div>
</div>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QUESTION </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   For each publisher, list the name of the publisher and total</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of pages that the publisher has published in all their books (ie. add</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># up all the pages in all books for each publisher). Show the publishers who</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># have published the most pages at the top of the result list.</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1 - since publishers contains the pub_name  and  titles contains the </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># number of pages (num_pages) for each book, we need to join those tables.</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select *</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
2     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
3     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
4     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
6     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
7     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
8     P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
9     P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
10    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
11    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            &lt;NA&gt;
12    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
13    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2 - use group by and sum to add up the pages for each publisher</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name, sum(pages)</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="st">       group by publishers.pub_id, pub_name</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name sum(pages)
1    Abatis Publishers       1399
2      Core Dump Books       1226
3 Schandenfreude Press       1149
4       AAA Publishing       1333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3 - use order by </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name, sum(pages)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="st">       group by publishers.pub_id, pub_name</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="st">       order by sum(pages) desc</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name sum(pages)
1    Abatis Publishers       1399
2       AAA Publishing       1333
3      Core Dump Books       1226
4 Schandenfreude Press       1149</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># REMEMBER - every inner join starts out under the covers as a cross join</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The following two commands are equivalent</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname   </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors INNER join title_authors on authors.au_id = title_authors.au_id    </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where title_id = 'T11'</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname au_lname
1   Hallie     Hull
2     Klee     Hull
3   Harvey  Kellsey</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname   </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors CROSS join title_authors    </span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="st">      where authors.au_id = title_authors.au_id</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="st">                  and </span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="st">            title_id = 'T11'</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname au_lname
1   Hallie     Hull
2     Klee     Hull
3   Harvey  Kellsey</code></pre>
</div>
</div>
</section>
<section id="even-more-types-of-joins" class="level2">
<h2 class="anchored" data-anchor-id="even-more-types-of-joins">Even more types of JOINs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># SEVERAL DIFFERENT TYPES OF "JOINS"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: There are actually several different types of "joins". They all do</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># slightly different things. For example:</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    CROSS JOIN                             - see the top of this file</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    INNER JOIN (or just JOIN)              - we just described this above</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    LEFT OUTER JOIN  (or just LEFT JOIN)   - we'll cover this later</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    RIGHT OUTER JOIN  (or just RIGHT JOIN) - we'll cover this later</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    FULL OUTER JOIN  (or just FULL JOIN)   - we'll cover this later</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># INNER JOIN   ( or just "JOIN" )</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is an "inner join" (or just "join").</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (We already covered this above. It's repeated here for completeness).</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, pub_name</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="st">      from favTitles JOIN favPublishers ON favTitles.pub_id = favPublishers.pub_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name          pub_name
1   But I Did It Unconciously Abatis Publishers
2      Exchange of Platitudes Abatis Publishers
3 Not Without My Fabrerge Egg    AAA Publishing</code></pre>
</div>
</div>
</section>
<section id="old-ansi-sql-way-of-doing-inner-joins" class="level2">
<h2 class="anchored" data-anchor-id="old-ansi-sql-way-of-doing-inner-joins">“old” ANSI SQL way of doing inner joins</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSI SQL  - American National Standards Institute </span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># There are different versions of the ANSI SQL standard. The versions are</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># named by the year that the version came out. See this for a full history of SQL:   </span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   https://learnsql.com/blog/history-of-sql-standards/</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Joins were done differently before SQL 92 </span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># They CAN still be done the "old way" (and often are). Some people prefer</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the "old way" since there is less to type.</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The "old way " for a cross join is to not specify cross join </span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># at all. Just list the tables with commas between them.</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="st">  select favTitles.*, favPublishers.*</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="st">  from favTitles, favPublishers</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages pub_id          pub_name     city
1   But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York
2   But I Did It Unconciously psychology    P01   510    P05    AAA Publishing Berkeley
3      Exchange of Platitudes psychology    P01   201    P01 Abatis Publishers New York
4      Exchange of Platitudes psychology    P01   201    P05    AAA Publishing Berkeley
5 Not Without My Fabrerge Egg  biography    P05    NA    P01 Abatis Publishers New York
6 Not Without My Fabrerge Egg  biography    P05    NA    P05    AAA Publishing Berkeley</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The "old way" of doing an "inner join" (i.e. a "regular - join")</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># is to do a "cross join" the old way and then add a where clause</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># that does the job of the "on".</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="st">  select favTitles.*, favPublishers.*</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="st">  from favTitles, favPublishers</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="st">  where favTitles.pub_id = favPublishers.pub_id</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   title_name       type pub_id pages pub_id          pub_name     city
1   But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York
2      Exchange of Platitudes psychology    P01   201    P01 Abatis Publishers New York
3 Not Without My Fabrerge Egg  biography    P05    NA    P05    AAA Publishing Berkeley</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in the "old way" of doing inner joins, you could add additional </span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># conditions to the where clause just like in the "new way" of</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># writing queries.</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="st">  select favTitles.*, favPublishers.*</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="st">  from favTitles, favPublishers</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="st">  where favTitles.pub_id = favPublishers.pub_id and</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="st">        pages &gt;= 300</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 title_name       type pub_id pages pub_id          pub_name     city
1 But I Did It Unconciously psychology    P01   510    P01 Abatis Publishers New York</code></pre>
</div>
</div>
</section>
<section id="left-join" class="level2">
<h2 class="anchored" data-anchor-id="left-join">LEFT JOIN</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># LEFT OUTER JOIN   (or just "LEFT JOIN")</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Before learning about "LEFT JOIN", you should first understand one </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># issue that comes up when using "INNER JOIN"s. </span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This issue is best shown by way of an example. </span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Publisher, P04 - Tenterhooks Press, does not have any corresponding rows in</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># the titles table (perhaps it's a new publishing company that is just getting</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># started).  For this reason when you use an "inner join" to join the titles</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># table and the publishers table you will NOT see any rows for Tenterhooks press.</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The following "inner join" (or just "join") shows the output below.</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenterhooks Press does not appear in the output at all.</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co">#    &gt; sqldf("select pub_name, title_name</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co">#           from publishers JOIN titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co">#           order by pub_name, title_name")</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co">#    </span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    pub_name                          title_name</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co">#    1        AAA Publishing         Not Without My Fabrerge Egg</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    2        AAA Publishing    Perhaps It's a Glandular Problem</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co">#    3        AAA Publishing           Spontaneous, Not Annoying</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    4     Abatis Publishers                               1977!</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="co">#    5     Abatis Publishers           But I Did It Unconciously</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co">#    6     Abatis Publishers              Exchange of Platitudes</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    7     Abatis Publishers                    How About Never?</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co">#    8     Abatis Publishers        Just Wait Until After School</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co">#    9     Abatis Publishers                     Kiss My Boo Boo</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co">#    10      Core Dump Books        Ask Yor System Administrator</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="co">#    11 Schandenfreude Press           200 Years of German Humor</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co">#    12 Schandenfreude Press                   I Blame My Mother</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="co">#    13 Schandenfreude Press What Are The Civilian Applications?</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="co"># However, suppose you want to see the same output, but you'd also like</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="co"># to see Tenterhooks Press, even though they haven't actually published</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="co"># any titles yet? .... that is where a LEFT JOIN is useful.</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="co"># The output of a "left join" contains all of the rows of an "inner join"</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="co"># plus possibly a few more rows that would not appear in the output of </span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="co"># an inner join. </span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="co"># By simply changing the "inner join" (i.e. "join") in the previous</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="co"># query to "left join" (or "left outer join") we get the following results.</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that Tenterhooks Press now DOES appear in a single row. </span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="co"># All columns that would have come from the corresponding rows in the titles</span></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="co"># table are NULL (i.e. NA in R dataframes) for the Tenterhooks Press row.</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="co">#    &gt; sqldf("select pub_name, title_name</span></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="co">#           from publishers LEFT JOIN titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="co">#           order by pub_name, title_name")</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a><span class="co">#    </span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="co">#    pub_name                          title_name</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a><span class="co">#    1        AAA Publishing         Not Without My Fabrerge Egg</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a><span class="co">#    2        AAA Publishing    Perhaps It's a Glandular Problem</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="co">#    3        AAA Publishing           Spontaneous, Not Annoying</span></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="co">#    4     Abatis Publishers                               1977!</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a><span class="co">#    5     Abatis Publishers           But I Did It Unconciously</span></span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a><span class="co">#    6     Abatis Publishers              Exchange of Platitudes</span></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a><span class="co">#    7     Abatis Publishers                    How About Never?</span></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a><span class="co">#    8     Abatis Publishers        Just Wait Until After School</span></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="co">#    9     Abatis Publishers                     Kiss My Boo Boo</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a><span class="co">#    10      Core Dump Books        Ask Yor System Administrator</span></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="co">#    11 Schandenfreude Press           200 Years of German Humor</span></span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a><span class="co">#    12 Schandenfreude Press                   I Blame My Mother</span></span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a><span class="co">#    13 Schandenfreude Press What Are The Civilian Applications?    </span></span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a><span class="co">#    14    Tneterhooks Press                                &lt;NA&gt;</span></span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a><span class="co"># WHAT DOES "LEFT" MEAN ???</span></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a><span class="co"># The word "left" and "right" in "left join" and "right join" refer to the</span></span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a><span class="co"># location of the table names in the SQL code. Specifically, the text of </span></span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a><span class="co"># the code of every JOIN has a table name to the LEFT of the word "JOIN" and </span></span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a><span class="co"># a table name to the right of the word "JOIN". When you specify</span></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a><span class="co">#       "... tableA LEFT JOIN tableB ON ..." </span></span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a><span class="co"># tableA is the "left" table and </span></span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a><span class="co"># tableB is the "right" table</span></span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a><span class="co"># The LEFT JOIN syntax says that if there are rows in the left table (tableA</span></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a><span class="co"># in the example above) that don't have corresponding rows in the "right" table</span></span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a><span class="co"># (tableB in the example above) then those rows from tableA should still </span></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a><span class="co"># appear in the output. Any columns that would have come from tableB will </span></span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a><span class="co"># have NULL values (i.e. NA in R dataframes) in that row.</span></span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is a "regular join" (i.e. an "inner join")</span></span>
<span id="cb50-93"><a href="#cb50-93" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenterhooks press does not show up since they have no titles</span></span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-97"><a href="#cb50-97" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select titles.title_name, pub_name, publishers.pub_id</span></span>
<span id="cb50-98"><a href="#cb50-98" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles join publishers on titles.pub_id = publishers.pub_id</span></span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name             pub_name pub_id
1          Not Without My Fabrerge Egg       AAA Publishing    P05
2     Perhaps It's a Glandular Problem       AAA Publishing    P05
3            Spontaneous, Not Annoying       AAA Publishing    P05
4                                1977!    Abatis Publishers    P01
5            But I Did It Unconciously    Abatis Publishers    P01
6               Exchange of Platitudes    Abatis Publishers    P01
7                     How About Never?    Abatis Publishers    P01
8         Just Wait Until After School    Abatis Publishers    P01
9                      Kiss My Boo Boo    Abatis Publishers    P01
10        Ask Yor System Administrator      Core Dump Books    P02
11           200 Years of German Humor Schandenfreude Press    P03
12                   I Blame My Mother Schandenfreude Press    P03
13 What Are The Civilian Applications? Schandenfreude Press    P03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is a "left join"</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenterhooks press DOES show up since a left join will add to </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the results of an inner join, any rows that appear in the "left"</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># hand table that have no corresponding rows in the right hand table.</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># In the result set, the columns from the right hand table in these</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># rows are NULL (or "NA" when using sqldf in R)</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select titles.title_name, pub_name, publishers.pub_id</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on titles.pub_id = publishers.pub_id</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name             pub_name pub_id
1          Not Without My Fabrerge Egg       AAA Publishing    P05
2     Perhaps It's a Glandular Problem       AAA Publishing    P05
3            Spontaneous, Not Annoying       AAA Publishing    P05
4                                1977!    Abatis Publishers    P01
5            But I Did It Unconciously    Abatis Publishers    P01
6               Exchange of Platitudes    Abatis Publishers    P01
7                     How About Never?    Abatis Publishers    P01
8         Just Wait Until After School    Abatis Publishers    P01
9                      Kiss My Boo Boo    Abatis Publishers    P01
10        Ask Yor System Administrator      Core Dump Books    P02
11           200 Years of German Humor Schandenfreude Press    P03
12                   I Blame My Mother Schandenfreude Press    P03
13 What Are The Civilian Applications? Schandenfreude Press    P03
14                                &lt;NA&gt;    Tneterhooks Press    P04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ALL of the columns from the right hand table contain NULLs (i.e. NA)</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for the extra rows that are added by the left join</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To prove that point, the following shows all of the columns from both</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the left hand table (publishers) and the right hand table (titles) </span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that ALL of the columns for the right hand table will have </span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># NULLs (i.e. NA in sqldf in R) for those rows of the output that </span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># contain data from the left hand table for which there is no corresponding</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># row in the right hand table</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.*, titles.*</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on titles.pub_id = publishers.pub_id</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            &lt;NA&gt;
2     P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
3     P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
4     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
6     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
7     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
8     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
9     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
10    P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
11    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
12    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
13    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
14    P04    Tneterhooks Press      Berkeley    CA     USA     &lt;NA&gt;                                &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA      NA            &lt;NA&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BE CAREFUL ...</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># When doing an "inner join" (i.e. a "join") it doesn't make a difference</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># which table you type to the left of the word "join" and which to the right.</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># HOWEVER - for "LEFT JOIN"s it DOES MATTER!!!</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># If we modify the previous query and put the publishers table on the </span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># right side of the "LEFT JOIN" keyword, we will again NOT see Teneterhooks Press</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># since a LEFT JOIN only adds extra rows to the output for the rows in the </span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># LEFT hand table that don't have corresponding rows in the right hand table.</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Tenterhooks Press does NOT appear since the publishers table is on the</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co"># right hand side of the "LEFT JOIN" keywords</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select titles.title_name, pub_name, publishers.pub_id</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles left join publishers on titles.pub_id = publishers.pub_id</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name             pub_name pub_id
1          Not Without My Fabrerge Egg       AAA Publishing    P05
2     Perhaps It's a Glandular Problem       AAA Publishing    P05
3            Spontaneous, Not Annoying       AAA Publishing    P05
4                                1977!    Abatis Publishers    P01
5            But I Did It Unconciously    Abatis Publishers    P01
6               Exchange of Platitudes    Abatis Publishers    P01
7                     How About Never?    Abatis Publishers    P01
8         Just Wait Until After School    Abatis Publishers    P01
9                      Kiss My Boo Boo    Abatis Publishers    P01
10        Ask Yor System Administrator      Core Dump Books    P02
11           200 Years of German Humor Schandenfreude Press    P03
12                   I Blame My Mother Schandenfreude Press    P03
13 What Are The Civilian Applications? Schandenfreude Press    P03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets add a row to the titles table that doesn't have a correponding row</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in the publishers table.</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>newBook <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">title_id=</span><span class="st">'014'</span>, <span class="at">title_name=</span><span class="st">'Data Everywhere'</span>, <span class="at">type=</span><span class="st">'computer'</span>, <span class="at">pub_id=</span><span class="st">'P99'</span>, <span class="at">pages=</span><span class="st">'200'</span>, <span class="at">price=</span><span class="st">'19.99'</span>, <span class="at">sales=</span><span class="dv">0</span>, <span class="at">pubdate=</span><span class="st">'1/01/2024'</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>titles2 <span class="ot">=</span> <span class="fu">rbind</span>(titles, newBook)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>titles2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 8
   title_id title_name                          type       pub_id pages price   sales pubdate        
   &lt;chr&gt;    &lt;chr&gt;                               &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1 T01      1977!                               history    P01    107   21.99     566 8/1/2000 0:00  
 2 T02      200 Years of German Humor           history    P03    14    19.95    9566 4/1/1998 0:00  
 3 T03      Ask Yor System Administrator        computer   P02    1226  39.95   25667 9/1/2000 0:00  
 4 T04      But I Did It Unconciously           psychology P01    510   12.99   13001 5/31/1999 0:00 
 5 T05      Exchange of Platitudes              psychology P01    201   6.95   201440 1/1/2001 0:00  
 6 T06      How About Never?                    biography  P01    473   19.95   11320 7/31/2000 0:00 
 7 T07      I Blame My Mother                   biography  P03    333   23.95 1500200 10/1/1999 0:00 
 8 T08      Just Wait Until After School        children   P01    86    10       4095 6/1/2001 0:00  
 9 T09      Kiss My Boo Boo                     children   P01    22    13.95    5000 5/31/2002 0:00 
10 T10      Not Without My Fabrerge Egg         biography  P05    &lt;NA&gt;  &lt;NA&gt;       NA &lt;NA&gt;           
11 T11      Perhaps It's a Glandular Problem    psychology P05    826   7.99    94123 11/30/2000 0:00
12 T12      Spontaneous, Not Annoying           biography  P05    507   12.99  100001 8/31/2000 0:00 
13 T13      What Are The Civilian Applications? history    P03    802   29.99   10467 5/31/1999 0:00 
14 014      Data Everywhere                     computer   P99    200   19.99       0 1/01/2024      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select titles2.title_name, pub_name, publishers.pub_id</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles2 on titles2.pub_id = publishers.pub_id</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name             pub_name pub_id
1          Not Without My Fabrerge Egg       AAA Publishing    P05
2     Perhaps It's a Glandular Problem       AAA Publishing    P05
3            Spontaneous, Not Annoying       AAA Publishing    P05
4                                1977!    Abatis Publishers    P01
5            But I Did It Unconciously    Abatis Publishers    P01
6               Exchange of Platitudes    Abatis Publishers    P01
7                     How About Never?    Abatis Publishers    P01
8         Just Wait Until After School    Abatis Publishers    P01
9                      Kiss My Boo Boo    Abatis Publishers    P01
10        Ask Yor System Administrator      Core Dump Books    P02
11           200 Years of German Humor Schandenfreude Press    P03
12                   I Blame My Mother Schandenfreude Press    P03
13 What Are The Civilian Applications? Schandenfreude Press    P03
14                                &lt;NA&gt;    Tneterhooks Press    P04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select titles2.title_name, pub_name, publishers.pub_id</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles2 left join publishers on titles2.pub_id = publishers.pub_id</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name             pub_name pub_id
1                      Data Everywhere                 &lt;NA&gt;   &lt;NA&gt;
2          Not Without My Fabrerge Egg       AAA Publishing    P05
3     Perhaps It's a Glandular Problem       AAA Publishing    P05
4            Spontaneous, Not Annoying       AAA Publishing    P05
5                                1977!    Abatis Publishers    P01
6            But I Did It Unconciously    Abatis Publishers    P01
7               Exchange of Platitudes    Abatis Publishers    P01
8                     How About Never?    Abatis Publishers    P01
9         Just Wait Until After School    Abatis Publishers    P01
10                     Kiss My Boo Boo    Abatis Publishers    P01
11        Ask Yor System Administrator      Core Dump Books    P02
12           200 Years of German Humor Schandenfreude Press    P03
13                   I Blame My Mother Schandenfreude Press    P03
14 What Are The Civilian Applications? Schandenfreude Press    P03</code></pre>
</div>
</div>
</section>
<section id="practice" class="level2">
<h2 class="anchored" data-anchor-id="practice">Practice</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################################</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PRACTICE QUESTION</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a query that shows the publisher name (i.e. pub_name) for those publishers</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (and only those publishers)) who have no titles in the titles table.</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################################################</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember this query</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.*, titles.*</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
2     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
3     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
4     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
6     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
7     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
8     P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
9     P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
10    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
11    P04    Tneterhooks Press      Berkeley    CA     USA     &lt;NA&gt;                                &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA      NA            &lt;NA&gt;
12    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            &lt;NA&gt;
13    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
14    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a where clause as shown below to get ONLY those rows from the left table that have no matching rows in the right table</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.*, titles.*</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type is null</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pub_id          pub_name     city state country title_id title_name type pub_id pages price sales pubdate
1    P04 Tneterhooks Press Berkeley    CA     USA     &lt;NA&gt;       &lt;NA&gt; &lt;NA&gt;   &lt;NA&gt;    NA    NA    NA    &lt;NA&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following works, but it isn't ideal .... because titles.type </span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># is not the best column to choose to test for null (keep reading for an explanation ...)</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type is null</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name
1 Tneterhooks Press</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To explain why titles.type was not the best column to choose above compare</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the query below where we used titles.pages to test for NULL. </span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Since there is a row in titles table that contains NULL for pages that row</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># causes the publisher for that row (i..e AAA Publishing) to be displayed</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># in the output.</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.pages is null</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name
1 Tneterhooks Press
2    AAA Publishing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------------------------------</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The best way to identify only those rows that were added due to the</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># "left" join is to look for NULL in a column that would otherwise never</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># contain a NULL.</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Best choices are</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - a primary key field (i.e. column)</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - or another column that is defined in the database to never allow NULLs</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------------------------------</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The best way to do the same query is by checking the primary key of the right </span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># hand table for NULL in the where clause.</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.title_id is null</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name
1 Tneterhooks Press</code></pre>
</div>
</div>
</section>
<section id="right-join-and-full-join" class="level2">
<h2 class="anchored" data-anchor-id="right-join-and-full-join">RIGHT JOIN and FULL JOIN</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################################.</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RIGHT JOIN    and    FULL JOIN</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># LEFT JOIN   is also known as a   LEFT OUTER JOIN</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># RIGHT JOIN   is also known as a  RIGHT OUTER JOIN</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># FULL JOIN   is also known as a   FULL OUTER JOIN</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co"># These are all known as "OUTER" joins</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################################.</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSI SQL also has "right join" and "full join"</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># A right join does the same thing as a left join except that</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co"># "right join" shows rows in the output that correspond to rows from the </span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co"># right hand table that don't have corresponding rows in the left hand table.</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The following LEFT JOIN ...</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.*, titles.*</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers left join titles on titles.pub_id = publishers.pub_id</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            &lt;NA&gt;
2     P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
3     P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
4     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
6     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
7     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
8     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
9     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
10    P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
11    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
12    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
13    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
14    P04    Tneterhooks Press      Berkeley    CA     USA     &lt;NA&gt;                                &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA      NA            &lt;NA&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ... will generate the EXACT SAME OUTPUT as the following RIGHT JOIN</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.*, titles.*</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles right join publishers on titles.pub_id = publishers.pub_id</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pub_name, title_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            &lt;NA&gt;
2     P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
3     P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
4     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
6     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
7     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
8     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
9     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
10    P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
11    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
12    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
13    P03 Schandenfreude Press       Hamburg  &lt;NA&gt; Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
14    P04    Tneterhooks Press      Berkeley    CA     USA     &lt;NA&gt;                                &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA      NA            &lt;NA&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HOWEVER - SQLite does not implement RIGHT JOIN even though it is part of the ANSI Standard for SQL</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Similarly a "full join" shows rows in the output for BOTH</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - rows in the left hand table that don't have corresponding rows in the right hand table and</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - rows in the right hand table that don't have corresponding rows in the left hand table and</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># SQLite - the database that are using does not implement RIGHT JOINs or FULL JOINs</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co"># However, there are simple workarounds for both.</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The workaround for a right join is simply to use a left join and type </span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the table names in the opposite order.</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The workaround for FULL JOIN requires you to understand "UNION" ... see below</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################################.</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="do">### UPDATE !!!</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="do">###     As of now (in 2024) sqlite has implemented both RIGHT JOIN</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="do">###     and FULL JOIN. I will update these notes with that info soon.</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################################.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sql-set-operations-i.e.-union-except-intersect" class="level2">
<h2 class="anchored" data-anchor-id="sql-set-operations-i.e.-union-except-intersect">SQL set operations (i.e.&nbsp;UNION, EXCEPT, INTERSECT)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining the output of 2 queries</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     UNION</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     UNION ALL</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     EXCEPT</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     INTERSECT</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is a query that you should already understand.</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co"># There is nothing new here. We will see below how to rewrite this </span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># query in a different way by using "UNION"</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The following displays titles that have fewer than 10 pages</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co"># and also titles that have more than 20 pages.</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &lt; 10 or price &gt; 20</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="st">      order by price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price
1              Exchange of Platitudes  6.95
2    Perhaps It's a Glandular Problem  7.99
3                               1977! 21.99
4                   I Blame My Mother 23.95
5 What Are The Civilian Applications? 29.99
6        Ask Yor System Administrator 39.95</code></pre>
</div>
</div>
<section id="union" class="level3">
<h3 class="anchored" data-anchor-id="union">UNION</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------------------------</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># UNION</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># union is used to combine two different queries into one output set.</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The 2 queries must have the same number of columns and the same type</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># of columns.</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The order by is done after both queries and combines the rows from </span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># the two select statements in the specified order.</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------------------------</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co"># First ... let's see each of the queries on their own ...</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co"># get the titles that are &lt; 10 dollars</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &lt; 10</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        title_name price
1           Exchange of Platitudes  6.95
2 Perhaps It's a Glandular Problem  7.99</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the titles that are &gt; 20 dollars</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 20</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price
1                               1977! 21.99
2        Ask Yor System Administrator 39.95
3                   I Blame My Mother 23.95
4 What Are The Civilian Applications? 29.99</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let's see how to use</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># UNION to combine the two previous queries into a single output.</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &lt; 10</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="st">      union</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="st">      select title_name, price</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 20</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="st">      order by price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price
1              Exchange of Platitudes  6.95
2    Perhaps It's a Glandular Problem  7.99
3                               1977! 21.99
4                   I Blame My Mother 23.95
5 What Are The Civilian Applications? 29.99
6        Ask Yor System Administrator 39.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the same but order by title_name</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &lt; 10</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="st">      union</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="st">      select title_name, price</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 20</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price
1                               1977! 21.99
2        Ask Yor System Administrator 39.95
3              Exchange of Platitudes  6.95
4                   I Blame My Mother 23.95
5    Perhaps It's a Glandular Problem  7.99
6 What Are The Civilian Applications? 29.99</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Another example</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Show all book titles for which the price is &gt; 20 or the pages is &gt; 500</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price, pages</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 20 or pages &gt; 500</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="st">      order by price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price pages
1    Perhaps It's a Glandular Problem  7.99   826
2           But I Did It Unconciously 12.99   510
3           Spontaneous, Not Annoying 12.99   507
4                               1977! 21.99   107
5                   I Blame My Mother 23.95   333
6 What Are The Civilian Applications? 29.99   802
7        Ask Yor System Administrator 39.95  1226</code></pre>
</div>
</div>
</section>
<section id="union-all" class="level3">
<h3 class="anchored" data-anchor-id="union-all">UNION ALL</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------------</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># UNION removes duplicate rows from the output</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># UNION ALL does NOT remove duplicate rows</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------------</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Union removes duplicate rows from the output</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that some books match both conditions but only come up in the </span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="co"># results once. </span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price, pages</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 20</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="st">      union</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="st">      select title_name, price, pages</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="st">      where pages &gt; 500</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="st">      order by price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price pages
1    Perhaps It's a Glandular Problem  7.99   826
2           But I Did It Unconciously 12.99   510
3           Spontaneous, Not Annoying 12.99   507
4                               1977! 21.99   107
5                   I Blame My Mother 23.95   333
6 What Are The Civilian Applications? 29.99   802
7        Ask Yor System Administrator 39.95  1226</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># UNION ALL</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Running the same query as above but typing "UNION ALL"</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Will show the rows that meet both conditions, twice.</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price, pages</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 20</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="st">      union all</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="st">      select title_name, price, pages</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="st">      where pages &gt; 500</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="st">      order by price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price pages
1    Perhaps It's a Glandular Problem  7.99   826
2           But I Did It Unconciously 12.99   510
3           Spontaneous, Not Annoying 12.99   507
4                               1977! 21.99   107
5                   I Blame My Mother 23.95   333
6 What Are The Civilian Applications? 29.99   802
7 What Are The Civilian Applications? 29.99   802
8        Ask Yor System Administrator 39.95  1226
9        Ask Yor System Administrator 39.95  1226</code></pre>
</div>
</div>
</section>
<section id="practice-1" class="level3">
<h3 class="anchored" data-anchor-id="practice-1">Practice</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PRACTICE QUESTION</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the names of all authors and publishers and the city that they are from.</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicate if the row in the output is for a 'publisher' or for an 'author'.</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For authors dispaly the name of the author as FIRST LAST in a single column.</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This column should be called 'name' - this is the same column as </span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the publisher's name would appear. </span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the results by the name.</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NAME       CITY       Pub_or_author</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Joe Smith  New York   Author</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="co"># AAA pubs   Seattle    Publisher</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sue Cohen  LA         Author</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="co"># etc.</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="co"># We can create two queries, one for authors and one for publishers</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname || ' ' || au_lname as name, city, 'Author' as 'pub_or_author'</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               name          city pub_or_author
1     Sarah Buchman         Bronx        Author
2   Wendy Heydemark       Boulder        Author
3       Hallie Hull San Francisco        Author
4         Klee Hull San Francisco        Author
5   Christian Kells      New York        Author
6    Harvey Kellsey     Palo Alto        Author
7 Paddy O'Furniture      Sarasota        Author</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name, city, 'Publisher' as 'pub_or_author'</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name          city pub_or_author
1    Abatis Publishers      New York     Publisher
2      Core Dump Books San Francisco     Publisher
3 Schandenfreude Press       Hamburg     Publisher
4    Tneterhooks Press      Berkeley     Publisher
5       AAA Publishing      Berkeley     Publisher</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then combine the two queries with union</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname || ' ' || au_lname as name, city, 'Author' as 'pub_or_author'</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="st">      union</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="st">      select pub_name, city, 'Publisher' as 'pub_or_author'</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="st">      order by 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   name          city pub_or_author
1        AAA Publishing      Berkeley     Publisher
2     Abatis Publishers      New York     Publisher
3       Christian Kells      New York        Author
4       Core Dump Books San Francisco     Publisher
5           Hallie Hull San Francisco        Author
6        Harvey Kellsey     Palo Alto        Author
7             Klee Hull San Francisco        Author
8     Paddy O'Furniture      Sarasota        Author
9         Sarah Buchman         Bronx        Author
10 Schandenfreude Press       Hamburg     Publisher
11    Tneterhooks Press      Berkeley     Publisher
12      Wendy Heydemark       Boulder        Author</code></pre>
</div>
</div>
</section>
<section id="except" class="level3">
<h3 class="anchored" data-anchor-id="except">EXCEPT</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co"># EXCEPT</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># QUESTION</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the publishers who publish biography books but not history books</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's start by first writing a query that gets those publishers who have</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co"># published biographies (spoiler alert ... we are later going to </span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co"># remove from this list those publishers who have published history books)</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct pub_name </span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'biography'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name
1    Abatis Publishers
2 Schandenfreude Press
3       AAA Publishing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you take out the distinct you will get duplicate copies of publisher names</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name </span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'biography'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name
1    Abatis Publishers
2 Schandenfreude Press
3       AAA Publishing
4       AAA Publishing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You get the duplicates for publishers who published more than one biography</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You can see that by looking at all of the data, not just the publisher name.</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.*, titles.*</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'biography'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pub_id             pub_name     city state country title_id                  title_name      type pub_id pages price   sales        pubdate
1    P01    Abatis Publishers New York    NY     USA      T06            How About Never? biography    P01   473 19.95   11320 7/31/2000 0:00
2    P03 Schandenfreude Press  Hamburg  &lt;NA&gt; Germany      T07           I Blame My Mother biography    P03   333 23.95 1500200 10/1/1999 0:00
3    P05       AAA Publishing Berkeley    CA     USA      T10 Not Without My Fabrerge Egg biography    P05    NA    NA      NA           &lt;NA&gt;
4    P05       AAA Publishing Berkeley    CA     USA      T12   Spontaneous, Not Annoying biography    P05   507 12.99  100001 8/31/2000 0:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Once again, this is the query that shows publishers who published biographies</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct pub_name </span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'biography'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name
1    Abatis Publishers
2 Schandenfreude Press
3       AAA Publishing</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the query for publishers who published history books</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct pub_name </span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'history'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name
1    Abatis Publishers
2 Schandenfreude Press</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now show publishers who published biograhpies BUT NOT history books</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct pub_name </span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'biography'</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="st">      EXCEPT</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="st">      select distinct pub_name </span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="st">      where titles.type = 'history'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        pub_name
1 AAA Publishing</code></pre>
</div>
</div>
</section>
<section id="intersect" class="level3">
<h3 class="anchored" data-anchor-id="intersect">INTERSECT</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co"># INTERSECT</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the cities that have both publishers and authors residing there.</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="co"># show the cities that have publishers</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct city, state</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="st">      order by city</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           city state
1      Berkeley    CA
2       Hamburg  &lt;NA&gt;
3      New York    NY
4 San Francisco    CA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the cities that have authors</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct city, state</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="st">      order by city"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           city state
1       Boulder    CO
2         Bronx    NY
3      New York    NY
4     Palo Alto    CA
5 San Francisco    CA
6      Sarasota    FL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two queries with INTERSECT.</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This will only show rows that are output from both of the</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># select statements.</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"   select distinct city, state</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="st">          from publishers</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="st">      INTERSECT</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="st">         select distinct city, state</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="st">         from authors</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="st">         </span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="st">      order by city"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           city state
1      New York    NY
2 San Francisco    CA</code></pre>
</div>
</div>
</section>
</section>
<section id="subqueries" class="level2">
<h2 class="anchored" data-anchor-id="subqueries">Subqueries</h2>
<p>A “subquery” is a select statement that appears inside of another select statement. The larger select statement is often referred to as the “outer query” and the subquery is often referred to as the “inner query”. This will become much more understandable after seeing some of the examples shown below.</p>
<p>Note that a single outer query may contain several different subqueries. Also note that a subquery may itself contain yet another subquery.</p>
<p>Subqueries are most often found in the SELECT, FROM, WHERE and HAVING clauses of a SQL select statement. The easiest types of subqueries to understand are probably those that appear in the WHERE or HAVING clauses of a larger select statement. Below are some examples. We will cover other types of subqueries after these.</p>
<section id="subqueries-in-where-and-having-clauses" class="level3">
<h3 class="anchored" data-anchor-id="subqueries-in-where-and-having-clauses">Subqueries in WHERE and HAVING clauses</h3>
<p>Subqueries that appear in the WHERE or HAVING clause can be categorized by the “shape” (ie. number of rows and columns that are returned by the subquery).</p>
<ul>
<li><p>subqueries that return just one value (i.e.&nbsp;one row of one column)</p>
<p>These types of subqueries can be placed anywhere in the outer query that you normally would put a single value (e.g.&nbsp;before or after an operator such as a “&gt;” sign or “-” sign).</p></li>
<li><p>subqueries that return just on column but possibly many rows.</p>
<p>These types of subqueries are used to generate “lists” of value that can appear after the SQL IN operator (see below for an example).</p></li>
<li><p>subqueries that return any number of rows and any number of columns.</p>
<p>These types of subqueries may appear after the SQL keyword “EXISTS” which we discuss below.</p></li>
</ul>
<section id="subqueries-that-return-a-single-value" class="level4">
<h4 class="anchored" data-anchor-id="subqueries-that-return-a-single-value">Subqueries that return a single value</h4>
<p>In the following example, the subqueries appear after a “&gt;” and after a “&lt;”. Therefore the subquery MUST return just a single value.</p>
<p><strong>QUESTION</strong> (a) Show titles whose price is greater than the average price of all titles.</p>
<ol start="2" type="a">
<li>Show titles whose price is less than the average price of all titles.</li>
</ol>
<p><strong>ANSWER (a)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Titles whose price is greater than the average price of all titles</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; </span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="st">              (</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="st">                 select avg(price)</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="st">                 from titles</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="st">              )</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price
1                               1977! 21.99
2           200 Years of German Humor 19.95
3        Ask Yor System Administrator 39.95
4                    How About Never? 19.95
5                   I Blame My Mother 23.95
6 What Are The Civilian Applications? 29.99</code></pre>
</div>
</div>
<p><strong>ANSWER (b)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Titles whose price is less than the average price of all titles</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (same as above answer except we use "&lt;" instead of "&gt;")</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &lt;</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="st">              (</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="st">                 select avg(price)</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="st">                 from titles</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="st">              )</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        title_name price
1        But I Did It Unconciously 12.99
2           Exchange of Platitudes  6.95
3     Just Wait Until After School 10.00
4                  Kiss My Boo Boo 13.95
5 Perhaps It's a Glandular Problem  7.99
6        Spontaneous, Not Annoying 12.99</code></pre>
</div>
</div>
<p>Let’s show that the above queries actually did their jobs by determining the avg price of all titles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># average price of all titles</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">" select avg(price)</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="st">        from titles</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  avg(price)
1    18.3875</code></pre>
</div>
</div>
<p>YOU CANNOT WRITE THE ABOVE QUERIES WITHOUT USING A SUBQUERY!!!! THE FOLLOWING WILL PRODUCE AN <strong><em>ERROR</em></strong> SINCE YOU MAY NOT USE AN AGGREGATE FUNCTION SUCH AS AVG INSIDE A WHERE CLAUSE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; avg(price)</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: misuse of aggregate function avg()</code></pre>
</div>
</div>
</section>
</section>
<section id="subquery-in-having-clause" class="level3">
<h3 class="anchored" data-anchor-id="subquery-in-having-clause">Subquery in HAVING clause</h3>
<p>These are very similar to subqueries in the WHERE clause:</p>
<p><strong>Question:</strong></p>
<p>Show the types of books with the 3 highest avg prices. Sort the results in alphabetical order of the type name.</p>
<p><strong>ANSWER:</strong></p>
<p>The following will answer the question but it doesn’t put the rows in alphabetical order of the name of the type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select type, avg(price)</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="st">       from titles</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="st">       group by type</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="st">       order by avg(price) desc</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="st">       limit 3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       type avg(price)
1  computer   39.95000
2   history   23.97667
3 biography   18.96333</code></pre>
</div>
</div>
<p>To get just the 3 largest average prices, we had to use “order by avg(price) desc” combined with “limit 3” to get only the first 3 rows. However, that leaves the rows in the order of descending avg(price) and not in alphabetical order of the type as we had been asked to do.</p>
<p>We can get the rows in the right order by using a subquery as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select type, avg(price)</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="st">       from titles</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="st">       group by type</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="st">       HAVING avg(price) &gt;= </span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="st">                 (select avg(price) </span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="st">                  from titles</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="st">                  group by type</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="st">                  order by avg(price) desc</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="st">                  limit 1 offset 2)</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="st">       order by type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       type avg(price)
1 biography   18.96333
2  computer   39.95000
3   history   23.97667</code></pre>
</div>
</div>
<p>The following is the output of the subquery if it would have been run on its own.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="st">                  select avg(price) </span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="st">                  from titles</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="st">                  group by type</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="st">                  order by avg(price) desc</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="st">                  limit 1 offset 2</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="st">                "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  avg(price)
1   18.96333</code></pre>
</div>
</div>
<p>The subquery returns just the 3rd most expensive average price. When this is placed in the having clause of the outer query we get the rows we want without the need to use limit in the outer query. We can now order the outer query by the type column instead of by the price.</p>
</section>
<section id="subquery-in-select-from-where-having" class="level3">
<h3 class="anchored" data-anchor-id="subquery-in-select-from-where-having">Subquery in SELECT, FROM, WHERE, HAVING</h3>
<p>Now that you’ve seen the basic idea of a subquery, let’s just reiterate that a subquery can appear in any of the following clauses in a select statement:</p>
<pre><code> SELECT - the subquery must return a single item (i.e. single row single column)

 FROM - subqueries in the FROM clause may return many rows and many columns.
        The subquery is treated as though it were an actual table.
        You need to follow the subquery with a 'name' that will be used
        as the name of the pseudo-table that is generated by the subquery.
        This is similar to the way you can name columns with aliases.

 WHERE or the HAVING - these subqueries may return the following:

         (a)  a single row, single column , i.e. a single value
              e.g. a subquery that appears before or after a + sign or a &gt; sign
               or anywhere that you'd expect a single value to appear.

         (b) possibly many rows of a single column -
             after the IN operator

         (c) possibly many rows, many columns -
             after the EXISTS operator </code></pre>
</section>
<section id="subquery-in-select" class="level3">
<h3 class="anchored" data-anchor-id="subquery-in-select">subquery in SELECT</h3>
<p>Subqueries in the SELECT clause must return a single value (i.e.&nbsp;a single row with a single column).</p>
<p><strong>QUESTION</strong>: Write a query that shows the title_name, price and the amount the price is above average for those titles whose price is above average.</p>
<p><strong>ANSWER</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price, price - (select avg(price) from titles) as 'amt_above_avg'</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; (select avg(price) from titles)</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price amt_above_avg
1                               1977! 21.99        3.6025
2           200 Years of German Humor 19.95        1.5625
3        Ask Yor System Administrator 39.95       21.5625
4                    How About Never? 19.95        1.5625
5                   I Blame My Mother 23.95        5.5625
6 What Are The Civilian Applications? 29.99       11.6025</code></pre>
</div>
</div>
<p>Note that the subquery was required since you shouldn’t mix aggregate functions, e.g.&nbsp;avg(price), in the select statement with non-aggregated columns (e.g.&nbsp;title_name). If you do, then the avg function implies that you will get the average of sevaral prices (i.e.&nbsp;the prices from several rows) being displayed <strong><em>in a single row of output</em></strong>. Howver, the non-aggregated columns such as title_name cannot be summarized into a single row, so the implication is that there should be several rows of output.</p>
<p>In ANSI SQL this is an error. However, the SQLite flavor of SQL that we are using allows this but only returns ONE row of data. This is VERY misleading. For example, with a subquery, using sqlite we get the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price, price - avg(price) as 'amt_above_avg'</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; (select avg(price) from titles)</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  title_name price amt_above_avg
1      1977! 21.99     -3.973333</code></pre>
</div>
</div>
<p>Which seems to imply that there is only one row for a book whose price is above average. However, as we saw in the correct answer shown above, there are actually six such book in our titles table.</p>
<p>Bottom line is that you need to use the version above that has the subquery to answer this question correctly.</p>
</section>
<section id="you-may-have-more-than-one-subquery" class="level3">
<h3 class="anchored" data-anchor-id="you-may-have-more-than-one-subquery">You may have more than one subquery</h3>
<p><strong>QUESTION</strong>: Same as above but also show the average price of all books as a column in the results.</p>
<p><strong>ANSWER</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, </span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="st">              price,</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="st">              (select avg(price) from titles) as avgPriceOfAllBooks,</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="st">              price - (select avg(price) from titles) as 'amt_above_avg'</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; (select avg(price) from titles)</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price avgPriceOfAllBooks amt_above_avg
1                               1977! 21.99            18.3875        3.6025
2           200 Years of German Humor 19.95            18.3875        1.5625
3        Ask Yor System Administrator 39.95            18.3875       21.5625
4                    How About Never? 19.95            18.3875        1.5625
5                   I Blame My Mother 23.95            18.3875        5.5625
6 What Are The Civilian Applications? 29.99            18.3875       11.6025</code></pre>
</div>
</div>
<p>When the query above is processed, the subqueries get run and produce the result 18.3875. That value is then plugged into the outer query and the outer query is run. The following is what the outer query would look like after the result of the subqueries are plugged into the outer query. You never have to type this. It is done automatically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, </span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="st">              price,</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="st">              18.3875 as avgPriceOfAllBooks,</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="st">              price - 18.3875 as 'amt_above_avg'</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where price &gt; 18.3875</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name price avgPriceOfAllBooks amt_above_avg
1                               1977! 21.99            18.3875        3.6025
2           200 Years of German Humor 19.95            18.3875        1.5625
3        Ask Yor System Administrator 39.95            18.3875       21.5625
4                    How About Never? 19.95            18.3875        1.5625
5                   I Blame My Mother 23.95            18.3875        5.5625
6 What Are The Civilian Applications? 29.99            18.3875       11.6025</code></pre>
</div>
</div>
</section>
<section id="subquery-after-in-can-return-a-single-column" class="level3">
<h3 class="anchored" data-anchor-id="subquery-after-in-can-return-a-single-column">subquery after IN can return a single column</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Subqueries that return a single column of values</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co"># can appear after the IN operator.</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Show authors that live in the same city as at least one  publisher</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># First let's get all the cities where publishers are located</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct city</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="st">      from publishers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           city
1      New York
2 San Francisco
3       Hamburg
4      Berkeley</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can use the "in" operator in sql to compare a value to a "list" of</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="co"># values.</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The following will work ... but it forces us to type in the names </span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co"># of the publisher's cities. If we change the data in the publishers table,</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co"># this "hard-coded" version of the query may not work correctly anymore.</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname, city</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="st">       from authors</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="st">       where city in ('New York','San Francisco','Hamburg','Berkeley')</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="st">       order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname au_lname          city
1    Hallie     Hull San Francisco
2      Klee     Hull San Francisco
3 Christian    Kells      New York</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can replace the list of cities with a subquery that automatically</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># figures out that list. This subquery returns a single column</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co"># that can be used in place of the hard-coded data from the previous query.</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname, city</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="st">       from authors</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="st">       where city in </span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="st">           (</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="st">              select distinct city </span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="st">              from publishers</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="st">           )</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="st">       order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname au_lname          city
1    Hallie     Hull San Francisco
2      Klee     Hull San Francisco
3 Christian    Kells      New York</code></pre>
</div>
</div>
</section>
<section id="subqueries-in-the-from-clause" class="level3">
<h3 class="anchored" data-anchor-id="subqueries-in-the-from-clause">Subqueries in the FROM clause</h3>
<p>Subqueries in the FROM clause may return many rows and many columns. The subquery is treated as though it were an actual table. You need to follow the subquery with a ‘name’ that will be used as the name of the pseudo-table that is generated by the subquery. This name is known as an ‘alias’ for the table. This is similar to the way you can name columns with aliases.</p>
<p><strong>QUESTION</strong></p>
<p>Show the title, price and type of each book. Also show the max and min and average prices of books of that category as additional columns in the output.</p>
<p>The results should appear as follows.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name price       type typeMaxPrice typeMinPrice typeAvgPrice
1                                1977! 21.99    history        29.99        19.95        23.98
2            200 Years of German Humor 19.95    history        29.99        19.95        23.98
3         Ask Yor System Administrator 39.95   computer        39.95        39.95        39.95
4            But I Did It Unconciously 12.99 psychology        12.99         6.95         9.31
5               Exchange of Platitudes  6.95 psychology        12.99         6.95         9.31
6                     How About Never? 19.95  biography        23.95        12.99        18.96
7                    I Blame My Mother 23.95  biography        23.95        12.99        18.96
8         Just Wait Until After School 10.00   children        13.95        10.00        11.97
9                      Kiss My Boo Boo 13.95   children        13.95        10.00        11.97
10         Not Without My Fabrerge Egg    NA  biography        23.95        12.99        18.96
11    Perhaps It's a Glandular Problem  7.99 psychology        12.99         6.95         9.31
12           Spontaneous, Not Annoying 12.99  biography        23.95        12.99        18.96
13 What Are The Civilian Applications? 29.99    history        29.99        19.95        23.98</code></pre>
</div>
</div>
<p><strong>ANSWER</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name, price, titles.type, typeMaxPrice, typeMinPrice, typeAvgPrice</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles JOIN (select type,</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="st">                               max(price) as typeMaxPrice, </span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="st">                               min(price) as typeMinPrice, </span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="st">                               round(avg(price),2) as typeAvgPrice</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="st">                        from titles</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="st">                        group by type) as summaryData</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="st">        ON titles.type = summaryData.type</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="st">      order by title_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Explanation:</strong></p>
<p>The subquery produces the result shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sqldf</span>(<span class="st">"select type,</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="st">                         max(price) as typeMaxPrice, </span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="st">                         min(price) as typeMinPrice, </span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="st">                         round(avg(price),2) as typeAvgPrice</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="st">                  from titles</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="st">                  group by type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        type typeMaxPrice typeMinPrice typeAvgPrice
1  biography        23.95        12.99        18.96
2   children        13.95        10.00        11.97
3   computer        39.95        39.95        39.95
4    history        29.99        19.95        23.98
5 psychology        12.99         6.95         9.31</code></pre>
</div>
</div>
<p>This result is called “summaryData” and is treated as a new table. This is not really a table in the database but can be used in the query as though there were such a table in the database.</p>
<p>This new “summaryData table” contains just one row for each type. We can therefore consider the “type” to be the primary key of this new “summaryData table. We then to JOIN the titles table with this new”summaryData table” by thinking of the summaryData.type column as the “primary key” of the summaryData table and the title.type column as a foreign key in the titles table that references the type column in the summaryData table.</p>
<p>The result is that we can mix non-aggregated data (e.g.&nbsp;title_name column) with aggregate data (e.g.&nbsp;max, min and avg of prices for each type) in the output of the query.</p>
</section>
</section>
<section id="correlated-subqueries" class="level2">
<h2 class="anchored" data-anchor-id="correlated-subqueries">Correlated Subqueries</h2>
<p>In a “correlated” subquery, the subquery is executed once for each row in the outer query. The subquery can refer to the data in the row for the outer query. Notice that in the following query the sub-query refers to the authors.au_id table even thought the from clause in the subquery does NOT include the authors table. This is actually a reference to the row from the authors table that is being processed while the subqery is running.</p>
<p>This subquery will be run again and again for every row that is processed in the outer query.</p>
<p>Notice that the subquery is in the where clause and the order by clause at the end is once again from the outer query.</p>
<p><strong>Example</strong>: Show authors who published more than 2 titles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="st">      where </span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="st">         (select count(*)</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="st">          from title_authors</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="st">          where authors.au_id = title_authors.au_id) &gt; 2</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname  au_lname
1    Sarah   Buchman
2    Wendy Heydemark
3     Klee      Hull
4   Harvey   Kellsey</code></pre>
</div>
</div>
<p>If you want to show the actual count in the output you would have to repeat the subquery in the SELECT clause of the outer query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname,</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="st">          (select count(*)</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="st">          from title_authors</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="st">          where authors.au_id = title_authors.au_id) as numTitles</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where </span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="st">         (select count(*)</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="st">          from title_authors</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="st">          where authors.au_id = title_authors.au_id) &gt; 2</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname  au_lname numTitles
1    Sarah   Buchman         3
2    Wendy Heydemark         4
3     Klee      Hull         4
4   Harvey   Kellsey         3</code></pre>
</div>
</div>
<p>You cannot run the subquery from a correlated-subquery on its own. It must be part of a larger query. For example the following TRIES to run the subquery from the previous example but fails with an error</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select count(*)</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="st">          from title_authors</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="st">          where authors.au_id = title_authors.au_id"</span>)  <span class="co"># ERROR - no such column authors.au_id</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: no such column: authors.au_id</code></pre>
</div>
</div>
<section id="a-separate-inner-query-is-run-for-every-row-that-is-processed-in-the-outer-query" class="level3">
<h3 class="anchored" data-anchor-id="a-separate-inner-query-is-run-for-every-row-that-is-processed-in-the-outer-query">A separate inner query is run for every row that is processed in the outer query</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the subquery that is run for the row in the authors for Sarah Buchman</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select count(*)</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="st">       from title_authors</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="st">       where 'A01' = title_authors.au_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count(*)
1        3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the subquery that is run for the row in the authors for Wendy Heydemark</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select count(*)</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="st">       from title_authors</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="st">       where 'A02' = title_authors.au_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count(*)
1        4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the subquery that is run for the row in the authors for Hallie Hull</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select count(*)</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="st">       from title_authors</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="st">       where 'A03' = title_authors.au_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count(*)
1        2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># etc ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="there-are-often-ways-to-avoid-subqueries" class="level4">
<h4 class="anchored" data-anchor-id="there-are-often-ways-to-avoid-subqueries">There are often ways to avoid subqueries</h4>
<p>The following is another way to get the same results without using any subqueries. Instead of a subquery, the following query uses a join and makes use of the group by and having clauses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="st">      group by authors.au_id, au_fname, au_lname</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="st">      having count(*) &gt; 2</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname  au_lname
1    Sarah   Buchman
2    Wendy Heydemark
3     Klee      Hull
4   Harvey   Kellsey</code></pre>
</div>
</div>
<p>Some people will think that the 1st version (with the subquery) is easier to understand.</p>
<p>Some people will think that the 2nd version (with the join, group by, having) is easier to understand.</p>
<p>Generally it is a matter of style - they are both valid.</p>
<p>(NOTE - As a general rule - you should avoid correlated subqueries if possible as they tend to run slower than other types of queries since the correlated subquery is run many times. This is a rule of thumb but depending on the exact queries, it is possible that a correlated subquery will run as fast or faster than alternate queries that return the same results.)</p>
<p>HOWEVER</p>
<p>If you want to actually see how many books each author wrote, only the 2nd version (without the subquery) will work. See the following. This is exactly the same as the 2nd query above with the addition of</p>
<pre><code>            count(*) as num_titles</code></pre>
<p>on the first line of the query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname, count(*) as num_titles </span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="st">      group by authors.au_id</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="st">      having count(*) &gt; 2</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname  au_lname num_titles
1    Sarah   Buchman          3
2    Wendy Heydemark          4
3     Klee      Hull          4
4   Harvey   Kellsey          3</code></pre>
</div>
</div>
<p>You CANNOT add the number of titles to the version with the subquery as the outer query does not have access to ANY information about the titles since the “from” in the outer query only includes the “authors” table. Therefore the “select” clause in the outer query may only refer to information from the authors table.</p>
<p><strong>TAKEAWAY</strong>: When using a subquery in the where or having clauses The only information that can be displayed by the outer query is info that is available in the tables listed in the “from” of the outer query.</p>
</section>
</section>
</section>
<section id="table-aliases-with-subqueries" class="level2">
<h2 class="anchored" data-anchor-id="table-aliases-with-subqueries">Table aliases with subqueries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># USING TABLE ALIASES FOR CORRELATED SUBQUERIES THAT USE THE SAME TABLES</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="co"># IN THE INNER AND OUTER QUERIES</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In correlated subqueries if the inner query refers to the same </span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="co"># table(s) as the outer query - you must use a table alias.</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the books whose length in pages is longer than the average</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="co"># length of books OF THE SAME TYPE</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="co"># You need to use a correlated subquery here. </span></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a><span class="co"># You need to use a subquery to compare the length of a particular</span></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a><span class="co"># book (which is a non-aggregated value) to the avg(length) </span></span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a><span class="co"># (which is an aggregated value). </span></span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a><span class="co"># To be more specific, you must use a "correlated" subquery</span></span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a><span class="co"># since each title will have a potentially differnt type. Therefore</span></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a><span class="co"># the average length will be potentially different for books</span></span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a><span class="co"># of different types and sql will need to run the subquery once</span></span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a><span class="co"># for each row in the titles table.</span></span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb170-24"><a href="#cb170-24" aria-hidden="true" tabindex="-1"></a><span class="co"># To be even more specific ... the inner query and the </span></span>
<span id="cb170-25"><a href="#cb170-25" aria-hidden="true" tabindex="-1"></a><span class="co"># outer query refer to the SAME table, i.e. the titles table.</span></span>
<span id="cb170-26"><a href="#cb170-26" aria-hidden="true" tabindex="-1"></a><span class="co"># AND the inner query must refer to information that is taken from </span></span>
<span id="cb170-27"><a href="#cb170-27" aria-hidden="true" tabindex="-1"></a><span class="co"># the outer query for that table. Therefore you must somehow make </span></span>
<span id="cb170-28"><a href="#cb170-28" aria-hidden="true" tabindex="-1"></a><span class="co"># it clear in the inner query which information is from the outer-query-title-table</span></span>
<span id="cb170-29"><a href="#cb170-29" aria-hidden="true" tabindex="-1"></a><span class="co"># and which information is from the version of the title table that is</span></span>
<span id="cb170-30"><a href="#cb170-30" aria-hidden="true" tabindex="-1"></a><span class="co"># in the inner query's from clause. </span></span>
<span id="cb170-31"><a href="#cb170-31" aria-hidden="true" tabindex="-1"></a><span class="co"># This is done by using "alias" names for the outer query's copy of the titles table</span></span>
<span id="cb170-32"><a href="#cb170-32" aria-hidden="true" tabindex="-1"></a><span class="co"># and a different "alias" for the inner query's copy of the titles table as shown below.</span></span>
<span id="cb170-33"><a href="#cb170-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-34"><a href="#cb170-34" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb170-35"><a href="#cb170-35" aria-hidden="true" tabindex="-1"></a><span class="st">      select title_name, type, pages</span></span>
<span id="cb170-36"><a href="#cb170-36" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles as outerTitles </span></span>
<span id="cb170-37"><a href="#cb170-37" aria-hidden="true" tabindex="-1"></a><span class="st">      where pages &gt; </span></span>
<span id="cb170-38"><a href="#cb170-38" aria-hidden="true" tabindex="-1"></a><span class="st">          (</span></span>
<span id="cb170-39"><a href="#cb170-39" aria-hidden="true" tabindex="-1"></a><span class="st">            select avg(pages) </span></span>
<span id="cb170-40"><a href="#cb170-40" aria-hidden="true" tabindex="-1"></a><span class="st">            from titles as innerTitles</span></span>
<span id="cb170-41"><a href="#cb170-41" aria-hidden="true" tabindex="-1"></a><span class="st">            where innerTitles.type = outerTitles.type</span></span>
<span id="cb170-42"><a href="#cb170-42" aria-hidden="true" tabindex="-1"></a><span class="st">          )</span></span>
<span id="cb170-43"><a href="#cb170-43" aria-hidden="true" tabindex="-1"></a><span class="st">      order by type, pages desc</span></span>
<span id="cb170-44"><a href="#cb170-44" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name       type pages
1           Spontaneous, Not Annoying  biography   507
2                    How About Never?  biography   473
3        Just Wait Until After School   children    86
4 What Are The Civilian Applications?    history   802
5    Perhaps It's a Glandular Problem psychology   826</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can prove to ourselves that this worked by showing the average</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="co"># number of pages for each type of title</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select type, avg(pages)</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="st">      group by type</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="st">      order by type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        type avg(pages)
1  biography   437.6667
2   children    54.0000
3   computer  1226.0000
4    history   307.6667
5 psychology   512.3333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can see those books that are below average in length for their</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co"># type of book by simply changing the &gt; to a &lt; in </span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the query</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="st">      select title_name, type, pages</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="st">      from titles as outerTitles </span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="st">      where pages &lt;</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="st">          (</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="st">            select avg(pages) </span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="st">            from titles as innerTitles</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="st">            where innerTitles.type = outerTitles.type</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="st">          )</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="st">      order by type, pages desc</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 title_name       type pages
1         I Blame My Mother  biography   333
2           Kiss My Boo Boo   children    22
3                     1977!    history   107
4 200 Years of German Humor    history    14
5 But I Did It Unconciously psychology   510
6    Exchange of Platitudes psychology   201</code></pre>
</div>
</div>
</section>
<section id="exists-some-subquery" class="level2">
<h2 class="anchored" data-anchor-id="exists-some-subquery">EXISTS (some subquery)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using "EXISTS" with correlated subqueries that may or may not return any rows.</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The EXISTS keyword can be used in WHERE and in HAVING clauses.</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g.    WHERE EXISTS (SOME_SUBQUERY)</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         HAVING EXISTS (SOME_SUBQUERY)</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The EXISTS keyword is always followed by a subquery.</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="co"># If the subquery returns any rows then EXISTS (subquery) evaluates to TRUE. </span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="co"># If the subquery returns zero rows then EXISTS (subquery) evaluates to FALSE. </span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="co"># "EXISTS ( some subquery )"  is used inside a where or having clause. </span></span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The row from the outer query is included in the results if the subquery</span></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a><span class="co"># contains ANY rows. The actual data resturned by the subqeury is not significant.</span></span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The only significance is if the subquery returns SOMETHING or returns NOTHING.</span></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE:</span></span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Show authors that live in the same city as at least one publisher.</span></span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a><span class="co"># [</span><span class="al">NOTE</span><span class="co">: above we saw a different way to do this by using "IN (subquery)" ]</span></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname, authors.city</span></span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors</span></span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="st">      where EXISTS</span></span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a><span class="st">              (select *</span></span>
<span id="cb176-30"><a href="#cb176-30" aria-hidden="true" tabindex="-1"></a><span class="st">               from publishers</span></span>
<span id="cb176-31"><a href="#cb176-31" aria-hidden="true" tabindex="-1"></a><span class="st">               where publishers.city = authors.city)</span></span>
<span id="cb176-32"><a href="#cb176-32" aria-hidden="true" tabindex="-1"></a><span class="st">      order by au_lname, au_fname</span></span>
<span id="cb176-33"><a href="#cb176-33" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname au_lname          city
1    Hallie     Hull San Francisco
2      Klee     Hull San Francisco
3 Christian    Kells      New York</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You know that the subquery is a CORRELATED subquery because it </span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cannot be run by itself (as shown below). This is because</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the query refers to the the authors table but does not include</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the authors table in the from clause.</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>( <span class="st">"select *</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="st">          from publishers</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="st">        where publishers.city = authors.city"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: no such column: authors.city</code></pre>
</div>
</div>
</section>
<section id="multiple-ways-of-accomplishing-the-same-thing" class="level2">
<h2 class="anchored" data-anchor-id="multiple-ways-of-accomplishing-the-same-thing">MULTIPLE WAYS OF ACCOMPLISHING THE SAME THING</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################.</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MULTIPLE WAYS OF ACCOMPLISHING THE SAME THING</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co"># There are often multiple different ways you can write queries</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="co"># that result in the same output. Different people will approach</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the same problem differently. </span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="co"># When faced with different approaches, you should try if possible to</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="co"># avoid correlated subqueries. This is because</span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a><span class="co"># as a "rule of thumb" correlated subqueries will run slower</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="co"># than other approaches since the subquery is re-run many times, </span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e. once for  each row in the outer query.</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is an example of a query that can be accomplished</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="co"># in many several different ways.</span></span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################.</span></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-18"><a href="#cb180-18" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------.</span></span>
<span id="cb180-19"><a href="#cb180-19" aria-hidden="true" tabindex="-1"></a><span class="co"># QUESTION:</span></span>
<span id="cb180-20"><a href="#cb180-20" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb180-21"><a href="#cb180-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   Write a query to show the names of the authors</span></span>
<span id="cb180-22"><a href="#cb180-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   who did NOT write any psychology books</span></span>
<span id="cb180-23"><a href="#cb180-23" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------.</span></span>
<span id="cb180-24"><a href="#cb180-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-25"><a href="#cb180-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-26"><a href="#cb180-26" aria-hidden="true" tabindex="-1"></a><span class="co">#...........................................................</span></span>
<span id="cb180-27"><a href="#cb180-27" aria-hidden="true" tabindex="-1"></a><span class="co"># One answer - using a correlated subquery with NOT EXISTS</span></span>
<span id="cb180-28"><a href="#cb180-28" aria-hidden="true" tabindex="-1"></a><span class="co">#...........................................................</span></span>
<span id="cb180-29"><a href="#cb180-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-30"><a href="#cb180-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Authors who did not write any psychology books:</span></span>
<span id="cb180-31"><a href="#cb180-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-32"><a href="#cb180-32" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select au_fname, au_lname</span></span>
<span id="cb180-33"><a href="#cb180-33" aria-hidden="true" tabindex="-1"></a><span class="st">       from authors</span></span>
<span id="cb180-34"><a href="#cb180-34" aria-hidden="true" tabindex="-1"></a><span class="st">       where NOT EXISTS</span></span>
<span id="cb180-35"><a href="#cb180-35" aria-hidden="true" tabindex="-1"></a><span class="st">             (select * </span></span>
<span id="cb180-36"><a href="#cb180-36" aria-hidden="true" tabindex="-1"></a><span class="st">              from title_authors join titles </span></span>
<span id="cb180-37"><a href="#cb180-37" aria-hidden="true" tabindex="-1"></a><span class="st">                                   on title_authors.title_id = titles.title_id</span></span>
<span id="cb180-38"><a href="#cb180-38" aria-hidden="true" tabindex="-1"></a><span class="st">              where title_authors.au_id = authors.au_id and</span></span>
<span id="cb180-39"><a href="#cb180-39" aria-hidden="true" tabindex="-1"></a><span class="st">                    type = 'psychology')</span></span>
<span id="cb180-40"><a href="#cb180-40" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb180-41"><a href="#cb180-41" aria-hidden="true" tabindex="-1"></a><span class="st">       order by au_lname, au_fname</span></span>
<span id="cb180-42"><a href="#cb180-42" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname    au_lname
1     Sarah     Buchman
2     Wendy   Heydemark
3 Christian       Kells
4     Paddy O'Furniture</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FYI - in case you're curious - this is a query for the authors who DID</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="co"># write psychology books</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="co"># authors who did write psychology books</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct au_fname, au_lname</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="st">       from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="st">                    join titles on title_authors.title_id = titles.title_id</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="st">       where type = 'psychology'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname au_lname
1   Hallie     Hull
2     Klee     Hull
3   Harvey  Kellsey</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">#...........................................................</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Another answer - using EXCEPT</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The first query before the except retrieves all the authors names.</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The 2nd query after the EXCEPT retrieves authors who wrote psychology books.</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The EXCEPT removes the rows returned by the 2nd query from the results of</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the first query.</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="co">#...........................................................</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Authors who did not write any psychology books:</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"-- get all the authors' names</span></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a><span class="st">       select au_fname, au_lname</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a><span class="st">       from authors</span></span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a><span class="st">   EXCEPT   -- except removes any row that appears in the 2nd query</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a><span class="st">      -- get the authors who wrote psychology books</span></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="st">      select distinct au_fname, au_lname</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a><span class="st">                   join titles on titles.title_id = title_authors.title_id</span></span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a><span class="st">      where type = 'psychology'</span></span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a><span class="st">   </span></span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a><span class="st">   order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname    au_lname
1     Sarah     Buchman
2     Wendy   Heydemark
3 Christian       Kells
4     Paddy O'Furniture</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">#...........................................................</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Another answer - using a LEFT JOIN combined with a subquery in a FROM clause.</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="co"># You can use a subquery in a FROM clause to create a temporary table</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="co"># that will be used for the query. The temporary table needs to be</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="co"># given an alias. </span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The example below uses a left join and a subquery in the FROM clause</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a><span class="co"># to retrieve the authors who did not write psychology books.</span></span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This is yet one more way to accomplish the same results as the </span></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a><span class="co"># examples above.</span></span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------.</span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Yet another way of doing the same thing - by using a LEFT join.</span></span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a><span class="co"># This also shows an example of using a subquery in a from clause</span></span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a><span class="co"># to create a temporary table.</span></span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a><span class="st">  select au_fname, au_lname</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a><span class="st">  from authors LEFT JOIN </span></span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a><span class="st">           -- the following subquery creates a temporary table</span></span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a><span class="st">           -- that contains the authors/titles of psychology books</span></span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="st">           (select *                 </span></span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a><span class="st">            from title_authors join titles </span></span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a><span class="st">                                 on title_authors.title_id = titles.title_id</span></span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a><span class="st">            where type = 'psychology') AS psychologyTitles</span></span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-31"><a href="#cb186-31" aria-hidden="true" tabindex="-1"></a><span class="st">       on authors.au_id = psychologyTitles.au_id</span></span>
<span id="cb186-32"><a href="#cb186-32" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb186-33"><a href="#cb186-33" aria-hidden="true" tabindex="-1"></a><span class="st">  where psychologyTitles.au_id is NULL</span></span>
<span id="cb186-34"><a href="#cb186-34" aria-hidden="true" tabindex="-1"></a><span class="st">  order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname    au_lname
1     Sarah     Buchman
2     Wendy   Heydemark
3 Christian       Kells
4     Paddy O'Furniture</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can see the contents of the temporary table by running the</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="co"># subquery by itself as shown here:</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select *</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="st">       from title_authors join titles </span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="st">                            on title_authors.title_id = titles.title_id</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="st">       where type = 'psychology'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  title_id au_id au_order royalty_shares title_id                       title_name       type pub_id pages price  sales         pubdate
1      T04   A03        1            0.6      T04        But I Did It Unconciously psychology    P01   510 12.99  13001  5/31/1999 0:00
2      T04   A04        2            0.4      T04        But I Did It Unconciously psychology    P01   510 12.99  13001  5/31/1999 0:00
3      T05   A04        1            1.0      T05           Exchange of Platitudes psychology    P01   201  6.95 201440   1/1/2001 0:00
4      T11   A03        2            0.3      T11 Perhaps It's a Glandular Problem psychology    P05   826  7.99  94123 11/30/2000 0:00
5      T11   A04        3            0.3      T11 Perhaps It's a Glandular Problem psychology    P05   826  7.99  94123 11/30/2000 0:00
6      T11   A06        1            0.4      T11 Perhaps It's a Glandular Problem psychology    P05   826  7.99  94123 11/30/2000 0:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can see all the columns from the left join here</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="st">  select *</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="st">  from authors LEFT JOIN </span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="st">           -- the following subquery creates a temporary table</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="st">           -- that contains the authors/titles of psychology books</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="st">           (select *                 </span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="st">            from title_authors join titles </span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="st">                                 on title_authors.title_id = titles.title_id</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a><span class="st">            where type = 'psychology') AS psychologyTitles</span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="st">       on authors.au_id = psychologyTitles.au_id</span></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a><span class="st">  -- where psychologyTitles.au_id is NULL</span></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="st">  order by au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_id  au_fname    au_lname        phone              address          city state   zip title_id au_id au_order royalty_shares title_id:1                       title_name       type pub_id pages price  sales         pubdate
1    A01     Sarah     Buchman 718-496-7223       75 West 205 St         Bronx    NY 10468     &lt;NA&gt;  &lt;NA&gt;       NA             NA       &lt;NA&gt;                             &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA     NA            &lt;NA&gt;
2    A02     Wendy   Heydemark 303-986-7020     2922 Baseline Rd       Boulder    CO 80303     &lt;NA&gt;  &lt;NA&gt;       NA             NA       &lt;NA&gt;                             &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA     NA            &lt;NA&gt;
3    A03    Hallie        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco    CA 94123      T04   A03        1            0.6        T04        But I Did It Unconciously psychology    P01   510 12.99  13001  5/31/1999 0:00
4    A03    Hallie        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco    CA 94123      T11   A03        2            0.3        T11 Perhaps It's a Glandular Problem psychology    P05   826  7.99  94123 11/30/2000 0:00
5    A04      Klee        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco    CA 94123      T04   A04        2            0.4        T04        But I Did It Unconciously psychology    P01   510 12.99  13001  5/31/1999 0:00
6    A04      Klee        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco    CA 94123      T05   A04        1            1.0        T05           Exchange of Platitudes psychology    P01   201  6.95 201440   1/1/2001 0:00
7    A04      Klee        Hull 415-549-4278 3800 Waldo Ave, #14F San Francisco    CA 94123      T11   A04        3            0.3        T11 Perhaps It's a Glandular Problem psychology    P05   826  7.99  94123 11/30/2000 0:00
8    A05 Christian       Kells 212-771-4680       114 Horatio St      New York    NY 10014     &lt;NA&gt;  &lt;NA&gt;       NA             NA       &lt;NA&gt;                             &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA     NA            &lt;NA&gt;
9    A06    Harvey     Kellsey 650-836-7128       390 Serra Mall     Palo Alto    CA 94305      T11   A06        1            0.4        T11 Perhaps It's a Glandular Problem psychology    P05   826  7.99  94123 11/30/2000 0:00
10   A07     Paddy O'Furniture 941-925-0752         1442 Main St      Sarasota    FL 34236     &lt;NA&gt;  &lt;NA&gt;       NA             NA       &lt;NA&gt;                             &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;    NA    NA     NA            &lt;NA&gt;</code></pre>
</div>
</div>
</section>
<section id="case---like-an-if-for-sql" class="level2">
<h2 class="anchored" data-anchor-id="case---like-an-if-for-sql">case - like an if for SQL</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################################.</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The case operator can appear in a SELECT clause to create a custom column.</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co"># It works similar to IF/ELSE/ELSE IF constructs that appear in other </span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># languages.</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The example below should be easy to understand.</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="co"># If there is no ELSE part and no conditions are true, it returns NULL.</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="co"># SELECT ... SOME COLUMNS ... , </span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="co">#       case when LOGICAL EXPRESSION then RESULT1</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="co">#            when LOGICAL EXPRESSION then RESULT2</span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="co">#            when LOGICAL EXPRESSION then RESULT3</span></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="co">#              ... etc</span></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="co">#            else RESULT_IF_NO_LOGICAL_EXPRESSION_WAS_TRUE</span></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a><span class="co">#       end   as   COLUMN_NAME,</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       ... SOME OTHER COLUMNS ...</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a><span class="co"># FROM ... etc</span></span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################################.</span></span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-24"><a href="#cb192-24" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE - this shows the lengths and prices of books in categories </span></span>
<span id="cb192-25"><a href="#cb192-25" aria-hidden="true" tabindex="-1"></a><span class="co">#           rather than actual numbers.</span></span>
<span id="cb192-26"><a href="#cb192-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-27"><a href="#cb192-27" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select title_name,</span></span>
<span id="cb192-28"><a href="#cb192-28" aria-hidden="true" tabindex="-1"></a><span class="st">              case</span></span>
<span id="cb192-29"><a href="#cb192-29" aria-hidden="true" tabindex="-1"></a><span class="st">                 when pages is null then 'unknown'</span></span>
<span id="cb192-30"><a href="#cb192-30" aria-hidden="true" tabindex="-1"></a><span class="st">                 when pages &lt; 100 then 'short'</span></span>
<span id="cb192-31"><a href="#cb192-31" aria-hidden="true" tabindex="-1"></a><span class="st">                 when pages &lt; 500 then 'medium'</span></span>
<span id="cb192-32"><a href="#cb192-32" aria-hidden="true" tabindex="-1"></a><span class="st">                 when pages &lt; 1000 then 'long'</span></span>
<span id="cb192-33"><a href="#cb192-33" aria-hidden="true" tabindex="-1"></a><span class="st">                 else  'crazy long'</span></span>
<span id="cb192-34"><a href="#cb192-34" aria-hidden="true" tabindex="-1"></a><span class="st">              end as length,</span></span>
<span id="cb192-35"><a href="#cb192-35" aria-hidden="true" tabindex="-1"></a><span class="st">              pages,</span></span>
<span id="cb192-36"><a href="#cb192-36" aria-hidden="true" tabindex="-1"></a><span class="st">              case</span></span>
<span id="cb192-37"><a href="#cb192-37" aria-hidden="true" tabindex="-1"></a><span class="st">                 when price &lt; 25 then 'cheap'</span></span>
<span id="cb192-38"><a href="#cb192-38" aria-hidden="true" tabindex="-1"></a><span class="st">                 when price is null then 'unknown'</span></span>
<span id="cb192-39"><a href="#cb192-39" aria-hidden="true" tabindex="-1"></a><span class="st">                 when price &lt; 30 then 'midrange'</span></span>
<span id="cb192-40"><a href="#cb192-40" aria-hidden="true" tabindex="-1"></a><span class="st">                 else 'expensive'</span></span>
<span id="cb192-41"><a href="#cb192-41" aria-hidden="true" tabindex="-1"></a><span class="st">              end as afforability,</span></span>
<span id="cb192-42"><a href="#cb192-42" aria-hidden="true" tabindex="-1"></a><span class="st">              price</span></span>
<span id="cb192-43"><a href="#cb192-43" aria-hidden="true" tabindex="-1"></a><span class="st">       from titles</span></span>
<span id="cb192-44"><a href="#cb192-44" aria-hidden="true" tabindex="-1"></a><span class="st">       order by pages, title_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            title_name     length pages afforability price
1          Not Without My Fabrerge Egg    unknown    NA      unknown    NA
2            200 Years of German Humor      short    14        cheap 19.95
3                      Kiss My Boo Boo      short    22        cheap 13.95
4         Just Wait Until After School      short    86        cheap 10.00
5                                1977!     medium   107        cheap 21.99
6               Exchange of Platitudes     medium   201        cheap  6.95
7                    I Blame My Mother     medium   333        cheap 23.95
8                     How About Never?     medium   473        cheap 19.95
9            Spontaneous, Not Annoying       long   507        cheap 12.99
10           But I Did It Unconciously       long   510        cheap 12.99
11 What Are The Civilian Applications?       long   802     midrange 29.99
12    Perhaps It's a Glandular Problem       long   826        cheap  7.99
13        Ask Yor System Administrator crazy long  1226    expensive 39.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EXAMPLE:</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Even if you don't understand this description the results below</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="co"># should be pretty easy to understand.</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="co"># DESCRIPTION: </span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a list of all the authors.</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Authors who wrote at least one psychology</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="co"># book should appear on a row with the word psycology in the column </span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="co"># named psycology_or_other.</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Authors who wrote non-psychology books should appear in a row with the</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="co"># word "other" in the psychology_or_other column.</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Authors who wrote both psychology and non-psychology books should</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="co"># appear in two different rows. One for pyschology and one for other.</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select distinct</span></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a><span class="st">              case when type = 'psychology' then 'psychology'</span></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="st">                   else 'other'</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="st">              end as pyschology_or_other,</span></span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a><span class="st">              au_lname, au_fname</span></span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a><span class="st">                   join titles on titles.title_id = title_authors.title_id</span></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a><span class="st">      order by pyschology_or_other, au_lname, au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pyschology_or_other  au_lname  au_fname
1               other   Buchman     Sarah
2               other Heydemark     Wendy
3               other      Hull      Klee
4               other     Kells Christian
5               other   Kellsey    Harvey
6          psychology      Hull    Hallie
7          psychology      Hull      Klee
8          psychology   Kellsey    Harvey</code></pre>
</div>
</div>
</section>
<section id="self-joins" class="level2">
<h2 class="anchored" data-anchor-id="self-joins">self joins</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Self joins</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A "self join" is used when you want to compare two different rows </span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="co"># FROM THE SAME TABLE. To do so, the from clause uses two different</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="co"># copies of the same table in a join. </span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The best way to understand this is with an example:</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------------------------------------------------------------</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="co"># find the names of authors who share the same address as another author</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------------------------------------------------------------</span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a><span class="co"># We want to compare two different rows from the authors table to see if</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="co"># they are from the same address. </span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the where clause ... why do you think it uses a "&gt;" sign?</span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a><span class="st">      select authors1.au_fname, authors1.au_lname, authors2.au_fname, authors2.au_lname, authors1.address</span></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors authors1 join authors authors2 on authors1.address = authors2.address</span></span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a><span class="st">      where authors1.au_id &gt; authors2.au_id "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname au_lname au_fname au_lname              address
1     Klee     Hull   Hallie     Hull 3800 Waldo Ave, #14F</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's analyze what's really going on by showing the CROSS JOIN that happens</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co"># internally as the above select statement is being processed</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select authors1.au_id, authors1.au_fname, authors1.au_lname, authors1.address,</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="st">              authors2.au_id, authors2.au_fname, authors2.au_lname, authors2.address</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="st">       from authors authors1 CROSS JOIN authors authors2</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="st">       order by authors1.au_id, authors2.au_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_id  au_fname    au_lname              address au_id  au_fname    au_lname              address
1    A01     Sarah     Buchman       75 West 205 St   A01     Sarah     Buchman       75 West 205 St
2    A01     Sarah     Buchman       75 West 205 St   A02     Wendy   Heydemark     2922 Baseline Rd
3    A01     Sarah     Buchman       75 West 205 St   A03    Hallie        Hull 3800 Waldo Ave, #14F
4    A01     Sarah     Buchman       75 West 205 St   A04      Klee        Hull 3800 Waldo Ave, #14F
5    A01     Sarah     Buchman       75 West 205 St   A05 Christian       Kells       114 Horatio St
6    A01     Sarah     Buchman       75 West 205 St   A06    Harvey     Kellsey       390 Serra Mall
7    A01     Sarah     Buchman       75 West 205 St   A07     Paddy O'Furniture         1442 Main St
8    A02     Wendy   Heydemark     2922 Baseline Rd   A01     Sarah     Buchman       75 West 205 St
9    A02     Wendy   Heydemark     2922 Baseline Rd   A02     Wendy   Heydemark     2922 Baseline Rd
10   A02     Wendy   Heydemark     2922 Baseline Rd   A03    Hallie        Hull 3800 Waldo Ave, #14F
11   A02     Wendy   Heydemark     2922 Baseline Rd   A04      Klee        Hull 3800 Waldo Ave, #14F
12   A02     Wendy   Heydemark     2922 Baseline Rd   A05 Christian       Kells       114 Horatio St
13   A02     Wendy   Heydemark     2922 Baseline Rd   A06    Harvey     Kellsey       390 Serra Mall
14   A02     Wendy   Heydemark     2922 Baseline Rd   A07     Paddy O'Furniture         1442 Main St
15   A03    Hallie        Hull 3800 Waldo Ave, #14F   A01     Sarah     Buchman       75 West 205 St
16   A03    Hallie        Hull 3800 Waldo Ave, #14F   A02     Wendy   Heydemark     2922 Baseline Rd
17   A03    Hallie        Hull 3800 Waldo Ave, #14F   A03    Hallie        Hull 3800 Waldo Ave, #14F
18   A03    Hallie        Hull 3800 Waldo Ave, #14F   A04      Klee        Hull 3800 Waldo Ave, #14F
19   A03    Hallie        Hull 3800 Waldo Ave, #14F   A05 Christian       Kells       114 Horatio St
20   A03    Hallie        Hull 3800 Waldo Ave, #14F   A06    Harvey     Kellsey       390 Serra Mall
21   A03    Hallie        Hull 3800 Waldo Ave, #14F   A07     Paddy O'Furniture         1442 Main St
22   A04      Klee        Hull 3800 Waldo Ave, #14F   A01     Sarah     Buchman       75 West 205 St
23   A04      Klee        Hull 3800 Waldo Ave, #14F   A02     Wendy   Heydemark     2922 Baseline Rd
24   A04      Klee        Hull 3800 Waldo Ave, #14F   A03    Hallie        Hull 3800 Waldo Ave, #14F
25   A04      Klee        Hull 3800 Waldo Ave, #14F   A04      Klee        Hull 3800 Waldo Ave, #14F
26   A04      Klee        Hull 3800 Waldo Ave, #14F   A05 Christian       Kells       114 Horatio St
27   A04      Klee        Hull 3800 Waldo Ave, #14F   A06    Harvey     Kellsey       390 Serra Mall
28   A04      Klee        Hull 3800 Waldo Ave, #14F   A07     Paddy O'Furniture         1442 Main St
29   A05 Christian       Kells       114 Horatio St   A01     Sarah     Buchman       75 West 205 St
30   A05 Christian       Kells       114 Horatio St   A02     Wendy   Heydemark     2922 Baseline Rd
31   A05 Christian       Kells       114 Horatio St   A03    Hallie        Hull 3800 Waldo Ave, #14F
32   A05 Christian       Kells       114 Horatio St   A04      Klee        Hull 3800 Waldo Ave, #14F
33   A05 Christian       Kells       114 Horatio St   A05 Christian       Kells       114 Horatio St
34   A05 Christian       Kells       114 Horatio St   A06    Harvey     Kellsey       390 Serra Mall
35   A05 Christian       Kells       114 Horatio St   A07     Paddy O'Furniture         1442 Main St
36   A06    Harvey     Kellsey       390 Serra Mall   A01     Sarah     Buchman       75 West 205 St
37   A06    Harvey     Kellsey       390 Serra Mall   A02     Wendy   Heydemark     2922 Baseline Rd
38   A06    Harvey     Kellsey       390 Serra Mall   A03    Hallie        Hull 3800 Waldo Ave, #14F
39   A06    Harvey     Kellsey       390 Serra Mall   A04      Klee        Hull 3800 Waldo Ave, #14F
40   A06    Harvey     Kellsey       390 Serra Mall   A05 Christian       Kells       114 Horatio St
41   A06    Harvey     Kellsey       390 Serra Mall   A06    Harvey     Kellsey       390 Serra Mall
42   A06    Harvey     Kellsey       390 Serra Mall   A07     Paddy O'Furniture         1442 Main St
43   A07     Paddy O'Furniture         1442 Main St   A01     Sarah     Buchman       75 West 205 St
44   A07     Paddy O'Furniture         1442 Main St   A02     Wendy   Heydemark     2922 Baseline Rd
45   A07     Paddy O'Furniture         1442 Main St   A03    Hallie        Hull 3800 Waldo Ave, #14F
46   A07     Paddy O'Furniture         1442 Main St   A04      Klee        Hull 3800 Waldo Ave, #14F
47   A07     Paddy O'Furniture         1442 Main St   A05 Christian       Kells       114 Horatio St
48   A07     Paddy O'Furniture         1442 Main St   A06    Harvey     Kellsey       390 Serra Mall
49   A07     Paddy O'Furniture         1442 Main St   A07     Paddy O'Furniture         1442 Main St</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you take out the where clause, you will get extra rows</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="st">      select authors1.au_fname, authors1.au_lname, authors2.au_fname, authors2.au_lname, authors1.address</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors authors1 join authors authors2 on authors1.address = authors2.address</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   au_fname    au_lname  au_fname    au_lname              address
1     Sarah     Buchman     Sarah     Buchman       75 West 205 St
2     Wendy   Heydemark     Wendy   Heydemark     2922 Baseline Rd
3    Hallie        Hull    Hallie        Hull 3800 Waldo Ave, #14F
4    Hallie        Hull      Klee        Hull 3800 Waldo Ave, #14F
5      Klee        Hull    Hallie        Hull 3800 Waldo Ave, #14F
6      Klee        Hull      Klee        Hull 3800 Waldo Ave, #14F
7 Christian       Kells Christian       Kells       114 Horatio St
8    Harvey     Kellsey    Harvey     Kellsey       390 Serra Mall
9     Paddy O'Furniture     Paddy O'Furniture         1442 Main St</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To understand why you get extra rows without the where take a look at the output</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the cross join of the authors table with itself. It is this cross join</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="co"># that is then filtered by the on clause and by the where clause.</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select authors1.au_fname, authors1.au_lname , authors1.address, authors2.au_fname, authors2.au_lname, authors2.address</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors as authors1   cross join    authors as authors2</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="st">      order by authors1.au_lname, authors1.au_fname, authors2.au_lname, authors2.au_fname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    au_fname    au_lname              address  au_fname    au_lname              address
1      Sarah     Buchman       75 West 205 St     Sarah     Buchman       75 West 205 St
2      Sarah     Buchman       75 West 205 St     Wendy   Heydemark     2922 Baseline Rd
3      Sarah     Buchman       75 West 205 St    Hallie        Hull 3800 Waldo Ave, #14F
4      Sarah     Buchman       75 West 205 St      Klee        Hull 3800 Waldo Ave, #14F
5      Sarah     Buchman       75 West 205 St Christian       Kells       114 Horatio St
6      Sarah     Buchman       75 West 205 St    Harvey     Kellsey       390 Serra Mall
7      Sarah     Buchman       75 West 205 St     Paddy O'Furniture         1442 Main St
8      Wendy   Heydemark     2922 Baseline Rd     Sarah     Buchman       75 West 205 St
9      Wendy   Heydemark     2922 Baseline Rd     Wendy   Heydemark     2922 Baseline Rd
10     Wendy   Heydemark     2922 Baseline Rd    Hallie        Hull 3800 Waldo Ave, #14F
11     Wendy   Heydemark     2922 Baseline Rd      Klee        Hull 3800 Waldo Ave, #14F
12     Wendy   Heydemark     2922 Baseline Rd Christian       Kells       114 Horatio St
13     Wendy   Heydemark     2922 Baseline Rd    Harvey     Kellsey       390 Serra Mall
14     Wendy   Heydemark     2922 Baseline Rd     Paddy O'Furniture         1442 Main St
15    Hallie        Hull 3800 Waldo Ave, #14F     Sarah     Buchman       75 West 205 St
16    Hallie        Hull 3800 Waldo Ave, #14F     Wendy   Heydemark     2922 Baseline Rd
17    Hallie        Hull 3800 Waldo Ave, #14F    Hallie        Hull 3800 Waldo Ave, #14F
18    Hallie        Hull 3800 Waldo Ave, #14F      Klee        Hull 3800 Waldo Ave, #14F
19    Hallie        Hull 3800 Waldo Ave, #14F Christian       Kells       114 Horatio St
20    Hallie        Hull 3800 Waldo Ave, #14F    Harvey     Kellsey       390 Serra Mall
21    Hallie        Hull 3800 Waldo Ave, #14F     Paddy O'Furniture         1442 Main St
22      Klee        Hull 3800 Waldo Ave, #14F     Sarah     Buchman       75 West 205 St
23      Klee        Hull 3800 Waldo Ave, #14F     Wendy   Heydemark     2922 Baseline Rd
24      Klee        Hull 3800 Waldo Ave, #14F    Hallie        Hull 3800 Waldo Ave, #14F
25      Klee        Hull 3800 Waldo Ave, #14F      Klee        Hull 3800 Waldo Ave, #14F
26      Klee        Hull 3800 Waldo Ave, #14F Christian       Kells       114 Horatio St
27      Klee        Hull 3800 Waldo Ave, #14F    Harvey     Kellsey       390 Serra Mall
28      Klee        Hull 3800 Waldo Ave, #14F     Paddy O'Furniture         1442 Main St
29 Christian       Kells       114 Horatio St     Sarah     Buchman       75 West 205 St
30 Christian       Kells       114 Horatio St     Wendy   Heydemark     2922 Baseline Rd
31 Christian       Kells       114 Horatio St    Hallie        Hull 3800 Waldo Ave, #14F
32 Christian       Kells       114 Horatio St      Klee        Hull 3800 Waldo Ave, #14F
33 Christian       Kells       114 Horatio St Christian       Kells       114 Horatio St
34 Christian       Kells       114 Horatio St    Harvey     Kellsey       390 Serra Mall
35 Christian       Kells       114 Horatio St     Paddy O'Furniture         1442 Main St
36    Harvey     Kellsey       390 Serra Mall     Sarah     Buchman       75 West 205 St
37    Harvey     Kellsey       390 Serra Mall     Wendy   Heydemark     2922 Baseline Rd
38    Harvey     Kellsey       390 Serra Mall    Hallie        Hull 3800 Waldo Ave, #14F
39    Harvey     Kellsey       390 Serra Mall      Klee        Hull 3800 Waldo Ave, #14F
40    Harvey     Kellsey       390 Serra Mall Christian       Kells       114 Horatio St
41    Harvey     Kellsey       390 Serra Mall    Harvey     Kellsey       390 Serra Mall
42    Harvey     Kellsey       390 Serra Mall     Paddy O'Furniture         1442 Main St
43     Paddy O'Furniture         1442 Main St     Sarah     Buchman       75 West 205 St
44     Paddy O'Furniture         1442 Main St     Wendy   Heydemark     2922 Baseline Rd
45     Paddy O'Furniture         1442 Main St    Hallie        Hull 3800 Waldo Ave, #14F
46     Paddy O'Furniture         1442 Main St      Klee        Hull 3800 Waldo Ave, #14F
47     Paddy O'Furniture         1442 Main St Christian       Kells       114 Horatio St
48     Paddy O'Furniture         1442 Main St    Harvey     Kellsey       390 Serra Mall
49     Paddy O'Furniture         1442 Main St     Paddy O'Furniture         1442 Main St</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You might think that we'd solve the problem if we used != instead of &gt;</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="co"># However, this is still a problem. Can you figure out why?</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="st">      select authors1.au_fname, authors1.au_lname, authors2.au_fname, authors2.au_lname, authors1.address</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors authors1 join authors authors2 on authors1.address = authors2.address</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="st">      where authors1.au_id != authors2.au_id "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname au_lname au_fname au_lname              address
1   Hallie     Hull     Klee     Hull 3800 Waldo Ave, #14F
2     Klee     Hull   Hallie     Hull 3800 Waldo Ave, #14F</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if we want to check that multiple columns are equal we can do that too </span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="st">      select authors1.au_fname, authors1.au_lname, authors2.au_fname, authors2.au_lname, authors1.address</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="st">      from authors authors1 join authors authors2 </span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="st">                  on </span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="st">           authors1.address = authors2.address and</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="st">           authors1.city = authors2.city and</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="st">           authors1.state = authors2.state and</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="st">           authors1.zip = authors2.zip</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="st">      where authors1.au_id &gt; authors2.au_id "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_fname au_lname au_fname au_lname              address
1     Klee     Hull   Hallie     Hull 3800 Waldo Ave, #14F</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If we used a subquery for this type of question</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we could not see both authors being displayed on the same row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="self-joins---another-example" class="level2">
<h2 class="anchored" data-anchor-id="self-joins---another-example">self joins - another example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOTHER SELF JOIN EXAMPLE</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Organization management hierarchy </span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - see the file "orgChart_large.png"</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------------</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>employees <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">empid =</span> <span class="fu">c</span>( <span class="dv">1</span>,         <span class="dv">2</span>,        <span class="dv">3</span>,          <span class="dv">4</span>,         <span class="dv">5</span>,   <span class="dv">6</span>,          <span class="dv">7</span>,           <span class="dv">8</span>,    <span class="dv">9</span>,         <span class="dv">10</span>,     <span class="dv">11</span>),</span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"ann"</span>,      <span class="st">"floyd"</span>, <span class="st">"randall"</span>,   <span class="st">"albert"</span>,<span class="st">"shawn"</span>,<span class="st">"tyrone"</span>, <span class="st">"calvin"</span>, <span class="st">"harold"</span>, <span class="st">"tanya"</span>, <span class="st">"jorge"</span>, <span class="st">"claire"</span> ),</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">lastname =</span> <span class="fu">c</span>(<span class="st">"sanders"</span>,<span class="st">"flake"</span>,<span class="st">"rodgers"</span>,   <span class="st">"aames"</span>,<span class="st">"stevens"</span>,<span class="st">"tex"</span>, <span class="st">"coolidge"</span>, <span class="st">"hughs"</span>, <span class="st">"tamashevsky"</span>,<span class="st">"jones"</span>, <span class="st">"coolidge"</span> ),</span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">salary =</span> <span class="fu">c</span>(<span class="dv">200</span>,       <span class="dv">50</span>,     <span class="dv">75</span>,            <span class="dv">90</span>,     <span class="dv">150</span>,     <span class="dv">250</span>,     <span class="dv">75</span>,        <span class="dv">190</span>,      <span class="dv">150</span>,    <span class="dv">175</span>,      <span class="dv">110</span> ),</span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">mgr =</span> <span class="fu">c</span>(<span class="cn">NA</span>,            <span class="dv">1</span>,        <span class="dv">1</span>,           <span class="dv">1</span>,       <span class="dv">2</span>,      <span class="dv">3</span>,        <span class="dv">3</span>,       <span class="dv">2</span>,         <span class="dv">7</span>,      <span class="dv">2</span>,        <span class="dv">7</span>)</span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a>employees</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   empid    name    lastname salary mgr
1      1     ann     sanders    200  NA
2      2   floyd       flake     50   1
3      3 randall     rodgers     75   1
4      4  albert       aames     90   1
5      5   shawn     stevens    150   2
6      6  tyrone         tex    250   3
7      7  calvin    coolidge     75   3
8      8  harold       hughs    190   2
9      9   tanya tamashevsky    150   7
10    10   jorge       jones    175   2
11    11  claire    coolidge    110   7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write a query that shows SO_AND_SO is managed by SO_AND_SO for each person</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select emp.name || ' is managed by ' || manager.name</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="st">       from employees AS emp join employees AS manager on emp.mgr = manager.empid</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="st">       order by emp.name</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   emp.name || ' is managed by ' || manager.name
1                       albert is managed by ann
2                   calvin is managed by randall
3                    claire is managed by calvin
4                        floyd is managed by ann
5                     harold is managed by floyd
6                      jorge is managed by floyd
7                      randall is managed by ann
8                      shawn is managed by floyd
9                     tanya is managed by calvin
10                  tyrone is managed by randall</code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To make it a little easier to read we could use the </span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="co"># aliasses emps and mgrs instead of emp1 and emp2</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select emps.name || ' is managed by ' || mgrs.name</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="st">       from employees emps join employees mgrs on emps.mgr = mgrs.empid</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="st">       order by emps.name</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   emps.name || ' is managed by ' || mgrs.name
1                     albert is managed by ann
2                 calvin is managed by randall
3                  claire is managed by calvin
4                      floyd is managed by ann
5                   harold is managed by floyd
6                    jorge is managed by floyd
7                    randall is managed by ann
8                    shawn is managed by floyd
9                   tanya is managed by calvin
10                tyrone is managed by randall</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select emps.name || ' is managed by ' || mgrs.name</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="st">       from employees as emps join employees as mgrs on emps.mgr = mgrs.empid</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="st">       order by emps.name</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   emps.name || ' is managed by ' || mgrs.name
1                     albert is managed by ann
2                 calvin is managed by randall
3                  claire is managed by calvin
4                      floyd is managed by ann
5                   harold is managed by floyd
6                    jorge is managed by floyd
7                    randall is managed by ann
8                    shawn is managed by floyd
9                   tanya is managed by calvin
10                tyrone is managed by randall</code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.pub_name, titles.title_name</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="st">       where publishers.pub_name like 'A%'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name                       title_name
1 Abatis Publishers                            1977!
2 Abatis Publishers        But I Did It Unconciously
3 Abatis Publishers           Exchange of Platitudes
4 Abatis Publishers                 How About Never?
5 Abatis Publishers     Just Wait Until After School
6 Abatis Publishers                  Kiss My Boo Boo
7    AAA Publishing      Not Without My Fabrerge Egg
8    AAA Publishing Perhaps It's a Glandular Problem
9    AAA Publishing        Spontaneous, Not Annoying</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.pub_name, titles.title_name</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="st">                                      and publishers.pub_name like 'A%'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name                       title_name
1 Abatis Publishers                            1977!
2 Abatis Publishers        But I Did It Unconciously
3 Abatis Publishers           Exchange of Platitudes
4 Abatis Publishers                 How About Never?
5 Abatis Publishers     Just Wait Until After School
6 Abatis Publishers                  Kiss My Boo Boo
7    AAA Publishing      Not Without My Fabrerge Egg
8    AAA Publishing Perhaps It's a Glandular Problem
9    AAA Publishing        Spontaneous, Not Annoying</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select publishers.pub_name, titles.title_name</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers, titles </span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="st">       where publishers.pub_id = titles.pub_id</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="st">             and publishers.pub_name like 'A%'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name                       title_name
1 Abatis Publishers                            1977!
2 Abatis Publishers        But I Did It Unconciously
3 Abatis Publishers           Exchange of Platitudes
4 Abatis Publishers                 How About Never?
5 Abatis Publishers     Just Wait Until After School
6 Abatis Publishers                  Kiss My Boo Boo
7    AAA Publishing      Not Without My Fabrerge Egg
8    AAA Publishing Perhaps It's a Glandular Problem
9    AAA Publishing        Spontaneous, Not Annoying</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It might help to understand what's going on by looking</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="co"># at the cross join of the two tables.</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select emps.*, mgrs.*</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="st">       from employees as emps CROSS JOIN employees as mgrs</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="st">       order by emps.empid, mgrs.empid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    empid    name    lastname salary mgr empid    name    lastname salary mgr
1       1     ann     sanders    200  NA     1     ann     sanders    200  NA
2       1     ann     sanders    200  NA     2   floyd       flake     50   1
3       1     ann     sanders    200  NA     3 randall     rodgers     75   1
4       1     ann     sanders    200  NA     4  albert       aames     90   1
5       1     ann     sanders    200  NA     5   shawn     stevens    150   2
6       1     ann     sanders    200  NA     6  tyrone         tex    250   3
7       1     ann     sanders    200  NA     7  calvin    coolidge     75   3
8       1     ann     sanders    200  NA     8  harold       hughs    190   2
9       1     ann     sanders    200  NA     9   tanya tamashevsky    150   7
10      1     ann     sanders    200  NA    10   jorge       jones    175   2
11      1     ann     sanders    200  NA    11  claire    coolidge    110   7
12      2   floyd       flake     50   1     1     ann     sanders    200  NA
13      2   floyd       flake     50   1     2   floyd       flake     50   1
14      2   floyd       flake     50   1     3 randall     rodgers     75   1
15      2   floyd       flake     50   1     4  albert       aames     90   1
16      2   floyd       flake     50   1     5   shawn     stevens    150   2
17      2   floyd       flake     50   1     6  tyrone         tex    250   3
18      2   floyd       flake     50   1     7  calvin    coolidge     75   3
19      2   floyd       flake     50   1     8  harold       hughs    190   2
20      2   floyd       flake     50   1     9   tanya tamashevsky    150   7
21      2   floyd       flake     50   1    10   jorge       jones    175   2
22      2   floyd       flake     50   1    11  claire    coolidge    110   7
23      3 randall     rodgers     75   1     1     ann     sanders    200  NA
24      3 randall     rodgers     75   1     2   floyd       flake     50   1
25      3 randall     rodgers     75   1     3 randall     rodgers     75   1
26      3 randall     rodgers     75   1     4  albert       aames     90   1
27      3 randall     rodgers     75   1     5   shawn     stevens    150   2
28      3 randall     rodgers     75   1     6  tyrone         tex    250   3
29      3 randall     rodgers     75   1     7  calvin    coolidge     75   3
30      3 randall     rodgers     75   1     8  harold       hughs    190   2
31      3 randall     rodgers     75   1     9   tanya tamashevsky    150   7
32      3 randall     rodgers     75   1    10   jorge       jones    175   2
33      3 randall     rodgers     75   1    11  claire    coolidge    110   7
34      4  albert       aames     90   1     1     ann     sanders    200  NA
35      4  albert       aames     90   1     2   floyd       flake     50   1
36      4  albert       aames     90   1     3 randall     rodgers     75   1
37      4  albert       aames     90   1     4  albert       aames     90   1
38      4  albert       aames     90   1     5   shawn     stevens    150   2
39      4  albert       aames     90   1     6  tyrone         tex    250   3
40      4  albert       aames     90   1     7  calvin    coolidge     75   3
41      4  albert       aames     90   1     8  harold       hughs    190   2
42      4  albert       aames     90   1     9   tanya tamashevsky    150   7
43      4  albert       aames     90   1    10   jorge       jones    175   2
44      4  albert       aames     90   1    11  claire    coolidge    110   7
45      5   shawn     stevens    150   2     1     ann     sanders    200  NA
46      5   shawn     stevens    150   2     2   floyd       flake     50   1
47      5   shawn     stevens    150   2     3 randall     rodgers     75   1
48      5   shawn     stevens    150   2     4  albert       aames     90   1
49      5   shawn     stevens    150   2     5   shawn     stevens    150   2
50      5   shawn     stevens    150   2     6  tyrone         tex    250   3
51      5   shawn     stevens    150   2     7  calvin    coolidge     75   3
52      5   shawn     stevens    150   2     8  harold       hughs    190   2
53      5   shawn     stevens    150   2     9   tanya tamashevsky    150   7
54      5   shawn     stevens    150   2    10   jorge       jones    175   2
55      5   shawn     stevens    150   2    11  claire    coolidge    110   7
56      6  tyrone         tex    250   3     1     ann     sanders    200  NA
57      6  tyrone         tex    250   3     2   floyd       flake     50   1
58      6  tyrone         tex    250   3     3 randall     rodgers     75   1
59      6  tyrone         tex    250   3     4  albert       aames     90   1
60      6  tyrone         tex    250   3     5   shawn     stevens    150   2
61      6  tyrone         tex    250   3     6  tyrone         tex    250   3
62      6  tyrone         tex    250   3     7  calvin    coolidge     75   3
63      6  tyrone         tex    250   3     8  harold       hughs    190   2
64      6  tyrone         tex    250   3     9   tanya tamashevsky    150   7
65      6  tyrone         tex    250   3    10   jorge       jones    175   2
66      6  tyrone         tex    250   3    11  claire    coolidge    110   7
67      7  calvin    coolidge     75   3     1     ann     sanders    200  NA
68      7  calvin    coolidge     75   3     2   floyd       flake     50   1
69      7  calvin    coolidge     75   3     3 randall     rodgers     75   1
70      7  calvin    coolidge     75   3     4  albert       aames     90   1
71      7  calvin    coolidge     75   3     5   shawn     stevens    150   2
72      7  calvin    coolidge     75   3     6  tyrone         tex    250   3
73      7  calvin    coolidge     75   3     7  calvin    coolidge     75   3
74      7  calvin    coolidge     75   3     8  harold       hughs    190   2
75      7  calvin    coolidge     75   3     9   tanya tamashevsky    150   7
76      7  calvin    coolidge     75   3    10   jorge       jones    175   2
77      7  calvin    coolidge     75   3    11  claire    coolidge    110   7
78      8  harold       hughs    190   2     1     ann     sanders    200  NA
79      8  harold       hughs    190   2     2   floyd       flake     50   1
80      8  harold       hughs    190   2     3 randall     rodgers     75   1
81      8  harold       hughs    190   2     4  albert       aames     90   1
82      8  harold       hughs    190   2     5   shawn     stevens    150   2
83      8  harold       hughs    190   2     6  tyrone         tex    250   3
84      8  harold       hughs    190   2     7  calvin    coolidge     75   3
85      8  harold       hughs    190   2     8  harold       hughs    190   2
86      8  harold       hughs    190   2     9   tanya tamashevsky    150   7
87      8  harold       hughs    190   2    10   jorge       jones    175   2
88      8  harold       hughs    190   2    11  claire    coolidge    110   7
89      9   tanya tamashevsky    150   7     1     ann     sanders    200  NA
90      9   tanya tamashevsky    150   7     2   floyd       flake     50   1
91      9   tanya tamashevsky    150   7     3 randall     rodgers     75   1
92      9   tanya tamashevsky    150   7     4  albert       aames     90   1
93      9   tanya tamashevsky    150   7     5   shawn     stevens    150   2
94      9   tanya tamashevsky    150   7     6  tyrone         tex    250   3
95      9   tanya tamashevsky    150   7     7  calvin    coolidge     75   3
96      9   tanya tamashevsky    150   7     8  harold       hughs    190   2
97      9   tanya tamashevsky    150   7     9   tanya tamashevsky    150   7
98      9   tanya tamashevsky    150   7    10   jorge       jones    175   2
99      9   tanya tamashevsky    150   7    11  claire    coolidge    110   7
100    10   jorge       jones    175   2     1     ann     sanders    200  NA
101    10   jorge       jones    175   2     2   floyd       flake     50   1
102    10   jorge       jones    175   2     3 randall     rodgers     75   1
103    10   jorge       jones    175   2     4  albert       aames     90   1
104    10   jorge       jones    175   2     5   shawn     stevens    150   2
105    10   jorge       jones    175   2     6  tyrone         tex    250   3
106    10   jorge       jones    175   2     7  calvin    coolidge     75   3
107    10   jorge       jones    175   2     8  harold       hughs    190   2
108    10   jorge       jones    175   2     9   tanya tamashevsky    150   7
109    10   jorge       jones    175   2    10   jorge       jones    175   2
110    10   jorge       jones    175   2    11  claire    coolidge    110   7
111    11  claire    coolidge    110   7     1     ann     sanders    200  NA
112    11  claire    coolidge    110   7     2   floyd       flake     50   1
113    11  claire    coolidge    110   7     3 randall     rodgers     75   1
114    11  claire    coolidge    110   7     4  albert       aames     90   1
115    11  claire    coolidge    110   7     5   shawn     stevens    150   2
116    11  claire    coolidge    110   7     6  tyrone         tex    250   3
117    11  claire    coolidge    110   7     7  calvin    coolidge     75   3
118    11  claire    coolidge    110   7     8  harold       hughs    190   2
119    11  claire    coolidge    110   7     9   tanya tamashevsky    150   7
120    11  claire    coolidge    110   7    10   jorge       jones    175   2
121    11  claire    coolidge    110   7    11  claire    coolidge    110   7</code></pre>
</div>
</div>
</section>
<section id="practice-question-rs-are-from-booksdatabase-word-document." class="level2">
<h2 class="anchored" data-anchor-id="practice-question-rs-are-from-booksdatabase-word-document.">Practice (question #rs are from booksDatabase Word document.)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################.</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PRACTICE with subqueries, outer joins, unions and other stuff.</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that many of the questions shown below come from the</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="co"># booksDatabase word document. The numbers for the questions</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="co"># are the numbers from that document.</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="question-35" class="level3">
<h3 class="anchored" data-anchor-id="question-35">Question 35</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the title names  and number of pages for those books that are</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="co"># longer than (ie.  more pages than) the average length of all books.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="st">select title_name , pages</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a><span class="st">from titles</span></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a><span class="st">where pages &gt;= (select avg(pages) from titles)</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           title_name pages
1        Ask Yor System Administrator  1226
2           But I Did It Unconciously   510
3                    How About Never?   473
4    Perhaps It's a Glandular Problem   826
5           Spontaneous, Not Annoying   507
6 What Are The Civilian Applications?   802</code></pre>
</div>
</div>
</section>
<section id="question-36" class="level3">
<h3 class="anchored" data-anchor-id="question-36">Question 36</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   Show each publisher's name and the number of authors who have written books</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for that publisher.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name, count(DISTINCT authors.au_id) as '# of authors'</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a><span class="st">from authors join title_authors on authors.au_id = title_authors.au_id </span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a><span class="st">join titles on title_authors.title_id = titles.title_id </span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a><span class="st">join publishers on publishers.pub_id = titles.pub_id</span></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a><span class="st">group by publishers.pub_id, pub_name;</span></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name # of authors
1    Abatis Publishers            5
2      Core Dump Books            1
3 Schandenfreude Press            3
4       AAA Publishing            4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EXPLANATION</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The following query shows the first step that would be necessariy to thinking about</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="co"># how to find the final answer (shown above). The following shows a separate</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="co"># row for each publisher and an author that wrote for that publisher. If you</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="co"># order the results by publisher, it is easy to see that you can think of</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="co"># each different publisher as a "group". That is what the group by</span></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="co"># does in the answer (see above). The count(DISTINCT authors.au_id)</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="co"># gets the number of "distinct" authors for the particular publisher.</span></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The "distinct" is necessary to ensure that you don't count an author</span></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a><span class="co"># twice for the same publisher (e.g. Sarah Buchman wrote two books</span></span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a><span class="co"># for Schandenfreude Press but should only be counted once as an</span></span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a><span class="co"># author for Scandenfreude Press)</span></span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name, authors.au_fname, authors.au_lname</span></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a><span class="st">from authors join title_authors on authors.au_id = title_authors.au_id </span></span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a><span class="st">join titles on title_authors.title_id = titles.title_id </span></span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a><span class="st">join publishers on publishers.pub_id = titles.pub_id</span></span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a><span class="st">order by pub_name, au_fname, au_lname</span></span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               pub_name  au_fname  au_lname
1        AAA Publishing    Hallie      Hull
2        AAA Publishing    Harvey   Kellsey
3        AAA Publishing      Klee      Hull
4        AAA Publishing     Wendy Heydemark
5        AAA Publishing     Wendy Heydemark
6     Abatis Publishers    Hallie      Hull
7     Abatis Publishers    Harvey   Kellsey
8     Abatis Publishers    Harvey   Kellsey
9     Abatis Publishers      Klee      Hull
10    Abatis Publishers      Klee      Hull
11    Abatis Publishers     Sarah   Buchman
12    Abatis Publishers     Wendy Heydemark
13      Core Dump Books Christian     Kells
14 Schandenfreude Press      Klee      Hull
15 Schandenfreude Press     Sarah   Buchman
16 Schandenfreude Press     Sarah   Buchman
17 Schandenfreude Press     Wendy Heydemark</code></pre>
</div>
</div>
</section>
<section id="question-36.5" class="level3">
<h3 class="anchored" data-anchor-id="question-36.5">Question 36.5</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the pub_name and the number of titles published by that publisher. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select pub_name, count(*) as num_titles</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="st">       from publishers join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="st">       group by publishers.pub_id, pub_name</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="st">       order by pub_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name num_titles
1       AAA Publishing          3
2    Abatis Publishers          6
3      Core Dump Books          1
4 Schandenfreude Press          3</code></pre>
</div>
</div>
</section>
<section id="question-37" class="level3">
<h3 class="anchored" data-anchor-id="question-37">Question 37</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the pub_name and the number of titles published by that publisher. </span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Only include publishers for whom at least 4 authors have worked. </span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (this question combines the concepts of the previous two questions)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name, count(*) as 'Number of Titles'</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="st">from publishers as pub1 join titles on pub1.pub_id = titles.pub_id</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="st">group by pub1.pub_id, pub_name</span></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="st">having   4 &lt;= ( select count(DISTINCT authors.au_id)</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="st">                from authors join title_authors on authors.au_id = title_authors.au_id </span></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a><span class="st">                join titles on title_authors.title_id = titles.title_id </span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a><span class="st">                join publishers as pub2 on pub2.pub_id = titles.pub_id</span></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="st">                where pub2.pub_id = pub1.pub_id ) </span></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a><span class="st">order by pub_name</span></span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name Number of Titles
1    AAA Publishing                3
2 Abatis Publishers                6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note - the subquery is a correlated subquery. </span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It returns the number of authors who published with a particular publisher.</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The following are the acutal subqueries that are run for each publisher:</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This happens automatically.</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For Abatis - 'P01'</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">" select count(DISTINCT authors.au_id)</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="st">        from authors join title_authors on authors.au_id = title_authors.au_id </span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a><span class="st">                     join titles on title_authors.title_id = titles.title_id </span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a><span class="st">                     join publishers as pub2 on pub2.pub_id = titles.pub_id</span></span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a><span class="st">        where pub2.pub_id = 'P01'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count(DISTINCT authors.au_id)
1                             5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Core Dump Books - 'P02'</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">" select count(DISTINCT authors.au_id)</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="st">        from authors join title_authors on authors.au_id = title_authors.au_id </span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="st">                     join titles on title_authors.title_id = titles.title_id </span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a><span class="st">                     join publishers as pub2 on pub2.pub_id = titles.pub_id</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="st">        where pub2.pub_id = 'P02'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count(DISTINCT authors.au_id)
1                             1</code></pre>
</div>
</div>
</section>
<section id="question-38" class="level3">
<h3 class="anchored" data-anchor-id="question-38">Question 38</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the names of publishers who did not publish any books.</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (I guess they are just getting started in the business ... )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER - with a subquery</span></span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name </span></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="st">from publishers  as   pub1</span></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a><span class="st">where not exists</span></span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="st">( select * </span></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a><span class="st">    from publishers  as pub2  join titles on pub2.pub_id = titles.pub_id</span></span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a><span class="st">  where pub2.pub_id = pub1.pub_id );</span></span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name
1 Tneterhooks Press</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER - with a left join</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="st">where title_id is NULL;</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pub_name
1 Tneterhooks Press</code></pre>
</div>
</div>
</section>
<section id="question-39a" class="level3">
<h3 class="anchored" data-anchor-id="question-39a">Question 39(a)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the name of each publisher and the total number of books that</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co"># each publisher has published. Sort the results so that the publishers who</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="co"># published the most books appear at the top. If two or more publishers</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="co"># published the same number of books then they should be listed in alphabetical order. </span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a.    The answer should only include publisher who have published some books.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name, count(*)</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="st">from titles join publishers on publishers.pub_id = titles.pub_id</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="st">group by pub_name</span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="st">order by count(*) desc, pub_name;</span></span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name count(*)
1    Abatis Publishers        6
2       AAA Publishing        3
3 Schandenfreude Press        3
4      Core Dump Books        1</code></pre>
</div>
</div>
</section>
<section id="question-39b" class="level3">
<h3 class="anchored" data-anchor-id="question-39b">Question 39(b)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (2nd part of previous question)</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="co"># b.    This time make sure to also include publishers who have published zero books</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name, count(titles.title_id)</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="st">from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a><span class="st">group by pub_name</span></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="st">order by count(*) desc, pub_name;</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name count(titles.title_id)
1    Abatis Publishers                      6
2       AAA Publishing                      3
3 Schandenfreude Press                      3
4      Core Dump Books                      1
5    Tneterhooks Press                      0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER - with a UNION - however the previous answer is shorter and more to the point</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name , 0  as  NumTitles</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="st">from publishers left join titles on publishers.pub_id = titles.pub_id</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="st">where title_id is NULL </span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a><span class="st">UNION</span></span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a><span class="st">select pub_name, count(*) as NumTitles</span></span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a><span class="st">from titles join publishers on publishers.pub_id = titles.pub_id</span></span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a><span class="st">group by pub_name;</span></span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              pub_name NumTitles
1       AAA Publishing         3
2    Abatis Publishers         6
3      Core Dump Books         1
4 Schandenfreude Press         3
5    Tneterhooks Press         0</code></pre>
</div>
</div>
</section>
<section id="question-46" class="level3">
<h3 class="anchored" data-anchor-id="question-46">Question 46</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################.</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="co"># QUESTION</span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################.</span></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the names of the most prolific authors, i.e. the authors </span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="co"># who have written the most books. Note that there could be</span></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="co"># several different authors who are "tied" for the most number of books </span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a><span class="co"># written. Sort the names in alphabetical order (last name, first name)</span></span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Also show the au_id and the number of titles that the author wrote.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANSWER</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="co">#~~~~~~~~~~~~~~~~.</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a rather complex answer.</span></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This approach uses a subquery within a subquery.</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="co"># There may be other approaches too.</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a><span class="co"># There may be simpler answers too.</span></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a><span class="co"># To explain we will show the subqueries and what they produce.</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we will show the full query that includes the subquery.</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The following query is NOT the answer. It is simply a query that </span></span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a><span class="co"># shows the number of books that were written by each author. This</span></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a><span class="co"># will be used as a subquery in the answer shown below.</span></span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a><span class="st">          select authors.au_id, count(*) as numTitles</span></span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a><span class="st">          from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb258-19"><a href="#cb258-19" aria-hidden="true" tabindex="-1"></a><span class="st">          group by authors.au_id, au_fname, au_lname</span></span>
<span id="cb258-20"><a href="#cb258-20" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_id numTitles
1   A01         3
2   A02         4
3   A03         2
4   A04         4
5   A05         1
6   A06         3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We'd like to get the max number of titles that an author wrote. </span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This amounts to getting the highest number from the numTitles column</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="co"># in the previous query. We can do that by using the above query </span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a><span class="co"># as a subquery in the from clause.</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a><span class="st">          select max(numTitles2) </span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a><span class="st">          from </span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="st">               (select authors.au_id, count(*) as numTitles2</span></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a><span class="st">                from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a><span class="st">                group by authors.au_id, au_fname, au_lname)</span></span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  max(numTitles2)
1               4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally we can put this all together to answer our question. </span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The following is the FULL ANSWER to the original question.</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="co"># It uses the above query as a subquery in the having clause (see </span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the code below). Note that in the following code there is a</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="co"># subquery inside of a subquery.</span></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="co"># FINAL ANSWER:</span></span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a><span class="st">select authors.au_id, au_fname, au_lname, count(*) as numTitles</span></span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a><span class="st">from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="st">group by authors.au_id, au_fname, au_lname</span></span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a><span class="st">having numTitles = </span></span>
<span id="cb262-14"><a href="#cb262-14" aria-hidden="true" tabindex="-1"></a><span class="st">          (select max(numTitles2) </span></span>
<span id="cb262-15"><a href="#cb262-15" aria-hidden="true" tabindex="-1"></a><span class="st">           from </span></span>
<span id="cb262-16"><a href="#cb262-16" aria-hidden="true" tabindex="-1"></a><span class="st">               (select authors.au_id, count(*) as numTitles2</span></span>
<span id="cb262-17"><a href="#cb262-17" aria-hidden="true" tabindex="-1"></a><span class="st">                from authors join title_authors on authors.au_id = title_authors.au_id</span></span>
<span id="cb262-18"><a href="#cb262-18" aria-hidden="true" tabindex="-1"></a><span class="st">                group by authors.au_id, au_fname, au_lname))</span></span>
<span id="cb262-19"><a href="#cb262-19" aria-hidden="true" tabindex="-1"></a><span class="st">order by au_lname, au_fname</span></span>
<span id="cb262-20"><a href="#cb262-20" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  au_id au_fname  au_lname numTitles
1   A02    Wendy Heydemark         4
2   A04     Klee      Hull         4</code></pre>
</div>
</div>
<!--

IGNORE THE REST OF THIS FILE



::: {.cell}

```{.r .cell-code}
#######################################################.
# IGNORE THE REST OF THIS FILE
#######################################################.


# The following left join works to show all publishers that do not have any
# titles in the database. 
sqldf("
select pub_name
from publishers left join titles on publishers.pub_id = titles.pub_id
where titles.type is null
")
```

::: {.cell-output .cell-output-stdout}

```
           pub_name
1 Tneterhooks Press
```


:::

```{.r .cell-code}
# The where clause in the above query uses titles.type. This is not the
# best column to use for this purpose since titles.type MIGHT be null (i.e. NA)
# for a "regular row" of the titles table.
# It is better to use a column such as titles.title_id since title_id cannot
# normally be NULL since it is a primary key field.
sqldf("
select pub_name
from publishers left join titles on publishers.pub_id = titles.pub_id
where titles.title_id is null
")
```

::: {.cell-output .cell-output-stdout}

```
           pub_name
1 Tneterhooks Press
```


:::

```{.r .cell-code}
# You can analyze what's going on a little better by showing ALL columns
# from both tables.
sqldf("
select publishers.*, titles.*    
from publishers left join titles on publishers.pub_id = titles.pub_id
where titles.type is null
")
```

::: {.cell-output .cell-output-stdout}

```
  pub_id          pub_name     city state country title_id title_name type pub_id pages price sales pubdate
1    P04 Tneterhooks Press Berkeley    CA     USA     <NA>       <NA> <NA>   <NA>    NA    NA    NA    <NA>
```


:::

```{.r .cell-code}
# If you take out the where clause you'll see all rows from the left join.
# This includes all rows that would come from a "regular" (i.e. inner) join
# PLUS any rows from the LEFT HAND table that DO NOT have corresponding rows
# in the right hand table (in this case Tenterhooks press is the only such row.)
sqldf("
select publishers.*, titles.*
from publishers left join titles on publishers.pub_id = titles.pub_id
")
```

::: {.cell-output .cell-output-stdout}

```
   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
2     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
3     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
4     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
6     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
7     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
8     P03 Schandenfreude Press       Hamburg  <NA> Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
9     P03 Schandenfreude Press       Hamburg  <NA> Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
10    P03 Schandenfreude Press       Hamburg  <NA> Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
11    P04    Tneterhooks Press      Berkeley    CA     USA     <NA>                                <NA>       <NA>   <NA>    NA    NA      NA            <NA>
12    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            <NA>
13    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
14    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
```


:::

```{.r .cell-code}
# Add a title that does not have an associated publisher in the publishers table
titles
```

::: {.cell-output .cell-output-stdout}

```
# A tibble: 13 × 8
   title_id title_name                          type       pub_id pages price   sales pubdate        
   <chr>    <chr>                               <chr>      <chr>  <dbl> <dbl>   <dbl> <chr>          
 1 T01      1977!                               history    P01      107 22.0      566 8/1/2000 0:00  
 2 T02      200 Years of German Humor           history    P03       14 20.0     9566 4/1/1998 0:00  
 3 T03      Ask Yor System Administrator        computer   P02     1226 40.0    25667 9/1/2000 0:00  
 4 T04      But I Did It Unconciously           psychology P01      510 13.0    13001 5/31/1999 0:00 
 5 T05      Exchange of Platitudes              psychology P01      201  6.95  201440 1/1/2001 0:00  
 6 T06      How About Never?                    biography  P01      473 20.0    11320 7/31/2000 0:00 
 7 T07      I Blame My Mother                   biography  P03      333 24.0  1500200 10/1/1999 0:00 
 8 T08      Just Wait Until After School        children   P01       86 10       4095 6/1/2001 0:00  
 9 T09      Kiss My Boo Boo                     children   P01       22 14.0     5000 5/31/2002 0:00 
10 T10      Not Without My Fabrerge Egg         biography  P05       NA NA         NA <NA>           
11 T11      Perhaps It's a Glandular Problem    psychology P05      826  7.99   94123 11/30/2000 0:00
12 T12      Spontaneous, Not Annoying           biography  P05      507 13.0   100001 8/31/2000 0:00 
13 T13      What Are The Civilian Applications? history    P03      802 30.0    10467 5/31/1999 0:00 
```


:::

```{.r .cell-code}
newRow = data.frame(title_id = "T14", title_name="Who ate my eggs?", type="children", pub_id="P99", pages=99, price=9.99, sales=100, pubdate='8/1/2020 0:00')
newRow
```

::: {.cell-output .cell-output-stdout}

```
  title_id       title_name     type pub_id pages price sales       pubdate
1      T14 Who ate my eggs? children    P99    99  9.99   100 8/1/2020 0:00
```


:::

```{.r .cell-code}
titles = rbind(titles, newRow)


# now we can reverse the tables (i.e. move the titles table to the right and
# publishers table to the left of the JOIN) and you'll see the rows from the titles table that
# dont have associated rows in the publishers table
# ( You dont have to change the order in the on clause).
#
# Let's start without the where clause
sqldf("
select publishers.*, titles.*    
from titles left join publishers on publishers.pub_id = titles.pub_id
")
```

::: {.cell-output .cell-output-stdout}

```
   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
2     P03 Schandenfreude Press       Hamburg  <NA> Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
3     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
4     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
5     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
6     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
7     P03 Schandenfreude Press       Hamburg  <NA> Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
8     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
9     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
10    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            <NA>
11    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
12    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
13    P03 Schandenfreude Press       Hamburg  <NA> Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
14   <NA>                 <NA>          <NA>  <NA>    <NA>      T14                    Who ate my eggs?   children    P99    99  9.99     100   8/1/2020 0:00
```


:::

```{.r .cell-code}
# If you want to see JUST the titles that don't have associated rows in the publishers
# table you could add a where clause as shown below
sqldf("
select publishers.*, titles.*    
from titles left join publishers on publishers.pub_id = titles.pub_id
where publishers.pub_id is NULL
")
```

::: {.cell-output .cell-output-stdout}

```
  pub_id pub_name city state country title_id       title_name     type pub_id pages price sales       pubdate
1   <NA>     <NA> <NA>  <NA>    <NA>      T14 Who ate my eggs? children    P99    99  9.99   100 8/1/2020 0:00
```


:::

```{.r .cell-code}
# The where clause in the above query uses titles.type. This is not the
# best column to use for this purpose since titles.type MIGHT be null (i.e. NA)
# for a "regular row" of the titles table.
# It is better to use a column such as titles.title_id since title_id cannot
# normally be NULL since it is a primary key field.
sqldf("
select publishers.*, titles.*
from publishers left join titles on publishers.pub_id = titles.pub_id
")
```

::: {.cell-output .cell-output-stdout}

```
   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
2     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
3     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
4     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
5     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
6     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
7     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
8     P03 Schandenfreude Press       Hamburg  <NA> Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
9     P03 Schandenfreude Press       Hamburg  <NA> Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
10    P03 Schandenfreude Press       Hamburg  <NA> Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
11    P04    Tneterhooks Press      Berkeley    CA     USA     <NA>                                <NA>       <NA>   <NA>    NA    NA      NA            <NA>
12    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            <NA>
13    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
14    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
```


:::

```{.r .cell-code}
# If you want to see JUST the titles that don't have associated rows in the publishers
# table you could add a where clause as shown below
sqldf("
select publishers.*, titles.*    
from titles left join publishers on publishers.pub_id = titles.pub_id
")
```

::: {.cell-output .cell-output-stdout}

```
   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
2     P03 Schandenfreude Press       Hamburg  <NA> Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
3     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
4     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
5     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
6     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
7     P03 Schandenfreude Press       Hamburg  <NA> Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
8     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
9     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
10    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            <NA>
11    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
12    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
13    P03 Schandenfreude Press       Hamburg  <NA> Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
14   <NA>                 <NA>          <NA>  <NA>    <NA>      T14                    Who ate my eggs?   children    P99    99  9.99     100   8/1/2020 0:00
```


:::

```{.r .cell-code}
# the following simulates a full join
sqldf("
select publishers.*, titles.*
from publishers left join titles on publishers.pub_id = titles.pub_id

union

select publishers.*, titles.*    
from titles left join publishers on publishers.pub_id = titles.pub_id
")
```

::: {.cell-output .cell-output-stdout}

```
   pub_id             pub_name          city state country title_id                          title_name       type pub_id pages price   sales         pubdate
1    <NA>                 <NA>          <NA>  <NA>    <NA>      T14                    Who ate my eggs?   children    P99    99  9.99     100   8/1/2020 0:00
2     P01    Abatis Publishers      New York    NY     USA      T01                               1977!    history    P01   107 21.99     566   8/1/2000 0:00
3     P01    Abatis Publishers      New York    NY     USA      T04           But I Did It Unconciously psychology    P01   510 12.99   13001  5/31/1999 0:00
4     P01    Abatis Publishers      New York    NY     USA      T05              Exchange of Platitudes psychology    P01   201  6.95  201440   1/1/2001 0:00
5     P01    Abatis Publishers      New York    NY     USA      T06                    How About Never?  biography    P01   473 19.95   11320  7/31/2000 0:00
6     P01    Abatis Publishers      New York    NY     USA      T08        Just Wait Until After School   children    P01    86 10.00    4095   6/1/2001 0:00
7     P01    Abatis Publishers      New York    NY     USA      T09                     Kiss My Boo Boo   children    P01    22 13.95    5000  5/31/2002 0:00
8     P02      Core Dump Books San Francisco    CA     USA      T03        Ask Yor System Administrator   computer    P02  1226 39.95   25667   9/1/2000 0:00
9     P03 Schandenfreude Press       Hamburg  <NA> Germany      T02           200 Years of German Humor    history    P03    14 19.95    9566   4/1/1998 0:00
10    P03 Schandenfreude Press       Hamburg  <NA> Germany      T07                   I Blame My Mother  biography    P03   333 23.95 1500200  10/1/1999 0:00
11    P03 Schandenfreude Press       Hamburg  <NA> Germany      T13 What Are The Civilian Applications?    history    P03   802 29.99   10467  5/31/1999 0:00
12    P04    Tneterhooks Press      Berkeley    CA     USA     <NA>                                <NA>       <NA>   <NA>    NA    NA      NA            <NA>
13    P05       AAA Publishing      Berkeley    CA     USA      T10         Not Without My Fabrerge Egg  biography    P05    NA    NA      NA            <NA>
14    P05       AAA Publishing      Berkeley    CA     USA      T11    Perhaps It's a Glandular Problem psychology    P05   826  7.99   94123 11/30/2000 0:00
15    P05       AAA Publishing      Berkeley    CA     USA      T12           Spontaneous, Not Annoying  biography    P05   507 12.99  100001  8/31/2000 0:00
```


:::

```{.r .cell-code}
sqldf("select title_name, price, rtrim(price,'0123456789') as 'whole number price', ltrim(price,'0123456789') as 'cents', trim(price,'0123456789') as 'a period'
      from titles")
```

::: {.cell-output .cell-output-stdout}

```
                            title_name price whole number price cents a period
1                                1977! 21.99                21.   .99        .
2            200 Years of German Humor 19.95                19.   .95        .
3         Ask Yor System Administrator 39.95                39.   .95        .
4            But I Did It Unconciously 12.99                12.   .99        .
5               Exchange of Platitudes  6.95                 6.   .95        .
6                     How About Never? 19.95                19.   .95        .
7                    I Blame My Mother 23.95                23.   .95        .
8         Just Wait Until After School 10.00                10.    .0        .
9                      Kiss My Boo Boo 13.95                13.   .95        .
10         Not Without My Fabrerge Egg    NA               <NA>  <NA>     <NA>
11    Perhaps It's a Glandular Problem  7.99                 7.   .99        .
12           Spontaneous, Not Annoying 12.99                12.   .99        .
13 What Are The Civilian Applications? 29.99                29.   .99        .
14                    Who ate my eggs?  9.99                 9.   .99        .
```


:::

```{.r .cell-code}
sqldf("select title_name, price, rtrim(price,'0123456789') as 'whole number price', 
                                 ltrim(price,'0123456789') as 'cents', 
                                 trim(price,'0123456789') as 'a period',
                                 rtrim(price,'.0123456789') as 'nothing left'
      from titles")
```

::: {.cell-output .cell-output-stdout}

```
                            title_name price whole number price cents a period nothing left
1                                1977! 21.99                21.   .99        .             
2            200 Years of German Humor 19.95                19.   .95        .             
3         Ask Yor System Administrator 39.95                39.   .95        .             
4            But I Did It Unconciously 12.99                12.   .99        .             
5               Exchange of Platitudes  6.95                 6.   .95        .             
6                     How About Never? 19.95                19.   .95        .             
7                    I Blame My Mother 23.95                23.   .95        .             
8         Just Wait Until After School 10.00                10.    .0        .             
9                      Kiss My Boo Boo 13.95                13.   .95        .             
10         Not Without My Fabrerge Egg    NA               <NA>  <NA>     <NA>         <NA>
11    Perhaps It's a Glandular Problem  7.99                 7.   .99        .             
12           Spontaneous, Not Annoying 12.99                12.   .99        .             
13 What Are The Civilian Applications? 29.99                29.   .99        .             
14                    Who ate my eggs?  9.99                 9.   .99        .             
```


:::
:::



-->
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>